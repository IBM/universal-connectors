input {
  generator { 
	  type => "hdfs"
	  lines => [
	  "2020-08-21 00:32:46,878 INFO FSNamesystem.audit: allowed=true	ugi=yarn/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=cancelDelegationToken	src=HDFS_DELEGATION_TOKEN token 76 for hive with renewer yarn	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:09:18,880 INFO FSNamesystem.audit: allowed=true	ugi=hdfs (auth:PROXY) via hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=create	src=/tmp/.cloudera_health_monitoring_canary_files/.canary_file_2020_08_15-04_09_18.1b64b2ebe9bba04f	dst=null	perm=hdfs:supergroup:rw-rw-rw-	proto=rpc",
	  "2020-08-15 04:09:18,948 INFO FSNamesystem.audit: allowed=true	ugi=hdfs (auth:PROXY) via hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=delete	src=/tmp/.cloudera_health_monitoring_canary_files/.canary_file_2020_08_15-04_09_18.1b64b2ebe9bba04f	dst=null	perm=null	proto=rpc",
	  "2020-08-21 00:17:08,713 INFO FSNamesystem.audit: allowed=true	ugi=hive/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=getDelegationToken	src=HDFS_DELEGATION_TOKEN token 75 for hive with renewer yarn	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:13:25,269 INFO FSNamesystem.audit: allowed=true	ugi=hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:PROXY) via hive/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=getEZForPath	src=/user/hue/.cloudera_manager_hive_metastore_canary/cloudera_manager_metastore_canary_test_catalog_hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f	dst=null	perm=hue:hue:rwxr-xr-x	proto=rpc",
	  "2020-08-15 04:09:18,877 INFO FSNamesystem.audit: allowed=true	ugi=hdfs (auth:PROXY) via hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=getfileinfo	src=/tmp/.cloudera_health_monitoring_canary_files	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:09:33,872 INFO FSNamesystem.audit: allowed=true	ugi=hdfs (auth:PROXY) via hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=listCacheDirectives	src={}	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:09:01,655 INFO FSNamesystem.audit: allowed=true	ugi=impala/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=listCachePools	src=null	dst=null	perm=null	proto=rpc",
	  "2020-08-15 05:00:00,020 INFO FSNamesystem.audit: allowed=true	ugi=hdfs/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=listEncryptionZones	src=null	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:08:44,473 INFO FSNamesystem.audit: allowed=true	ugi=hdfs/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=listStatus	src=/ranger/audit/hbase/hbaseMaster	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:13:24,160 INFO FSNamesystem.audit: allowed=true	ugi=hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:PROXY) via hive/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=mkdirs	src=/user/hue/.cloudera_manager_hive_metastore_canary/cloudera_manager_metastore_canary_test_catalog_hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f	dst=null	perm=hue:hue:rwxr-xr-x	proto=rpc",
	  "2020-08-15 04:08:44,462 INFO FSNamesystem.audit: allowed=true	ugi=hdfs/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=open	src=/ranger/audit/kafka/kafka/20200815/kafka_ranger_audit_cdp711-11.fyre.ibm.com.log	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:27:17,637 INFO FSNamesystem.audit: allowed=true	ugi=hbase/cdp711-51.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.150	cmd=rename	src=/hbase/WALs/cdp711-51.fyre.ibm.com,16020,1597181114113/cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.regiongroup-0.1597487237491	dst=/hbase/oldWALs/cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.regiongroup-0.1597487237491	perm=hbase:hbase:rw-r--r--	proto=rpc	callerContext=CLI",
	  "2020-08-15 05:00:00,035 INFO FSNamesystem.audit: allowed=true	ugi=hdfs/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=rename (options=[NONE])	src=/user/hue/.Trash/Current	dst=/user/hue/.Trash/200815050000	perm=hue:hue:rwx------	proto=rpc",
	  "2020-08-15 04:13:25,273 INFO FSNamesystem.audit: allowed=true	ugi=hue/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:PROXY) via hive/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=rename (options=[TO_TRASH])	src=/user/hue/.cloudera_manager_hive_metastore_canary/cloudera_manager_metastore_canary_test_catalog_hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f/hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f	dst=/user/hue/.Trash/Current/user/hue/.cloudera_manager_hive_metastore_canary/cloudera_manager_metastore_canary_test_catalog_hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f/hive_HIVEMETASTORE_b833a1435460949959526c72f67e2d0f1597490005271	perm=hue:hue:rwxr-xr-x	proto=rpc",
	  "2020-08-21 00:17:09,580 INFO FSNamesystem.audit: allowed=true	ugi=yarn/cdp711-11.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.88.114	cmd=renewDelegationToken	src=HDFS_DELEGATION_TOKEN token 76 for hive with renewer yarn	dst=null	perm=null	proto=rpc",
	  "2020-08-15 04:33:15,078 INFO FSNamesystem.audit: allowed=true	ugi=hdfs/cdp711-21.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.141	cmd=rollEditLog	src=null	dst=null	perm=null	proto=rpc",
	  "2020-08-15 17:04:03,741 INFO FSNamesystem.audit: allowed=true	ugi=hive/cdp711-21.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.141	cmd=setPermission	src=/warehouse/tablespace/managed/hive/sys.db/query_data/date=2020-08-16	dst=null	perm=hive:hive:rwxrwxrwt	proto=rpc",
	  "2020-08-15 07:37:15,643 INFO FSNamesystem.audit: allowed=true	ugi=hbase/cdp711-31.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.144	cmd=setStoragePolicy	src=/hbase/data/hbase/acl/84b41a3fe3a766e77434adb5dd4d7ddf/l	dst=null	perm=hbase:hbase:rwxr-xr-x	proto=rpc	callerContext=CLI",
	  "2020-08-15 04:27:17,631 INFO FSNamesystem.audit: allowed=true	ugi=hbase/cdp711-51.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.150	cmd=setTimes	src=/hbase/WALs/cdp711-51.fyre.ibm.com,16020,1597181114113/cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.cdp711-51.fyre.ibm.com%2C16020%2C1597181114113.regiongroup-0.1597487237491	dst=null	perm=hbase:hbase:rw-r--r--	proto=rpc	callerContext=CLI",
	  "2020-09-05 11:03:31,477 INFO FSNamesystem.audit: allowed=false	ugi=yarn/cdp711-41.fyre.ibm.com@DBANET4.ROOT (auth:KERBEROS)	ip=/9.46.89.146	cmd=setPermission	src=/tmp/logs	dst=null	perm=null	proto=rpc"
	  ]
	  count => 1 
  }
}

filter {
	if [type] == "hdfs" {
		if "callerContext=" in [message] and "trackingId=" in [message] {
			dissect {
				mapping => {
					"message" => "%{timestamp} INFO FSNamesystem.audit: allowed=%{allowed}	ugi=%{ugi}	ip=%{hostname}/%{ip}	cmd=%{cmd}	src=%{src}	dst=%{dst}	perm=%{perm}	trackingId=%{tracking_id}	proto=%{proto}	callerContext=%{call_ctx}"
				}
			}
		} else if "trackingId=" in [message] {
			dissect {
				mapping => {
					"message" => "%{timestamp} INFO FSNamesystem.audit: allowed=%{allowed}	ugi=%{ugi}	ip=%{hostname}/%{ip}	cmd=%{cmd}	src=%{src}	dst=%{dst}	perm=%{perm}	trackingId=%{tracking_id}	proto=%{proto}"
				}
			}
		} else if "callerContext=" in [message] {
			dissect {
				mapping => {
					"message" => "%{timestamp} INFO FSNamesystem.audit: allowed=%{allowed}	ugi=%{ugi}	ip=%{hostname}/%{ip}	cmd=%{cmd}	src=%{src}	dst=%{dst}	perm=%{perm}	proto=%{proto}	callerContext=%{call_ctx}"
				}
			}
		} else {
			dissect {
				mapping => {
					"message" => "%{timestamp} INFO FSNamesystem.audit: allowed=%{allowed}	ugi=%{ugi}	ip=%{hostname}/%{ip}	cmd=%{cmd}	src=%{src}	dst=%{dst}	perm=%{perm}	proto=%{proto}"
				}
			}
		}
		if "_dissectfailure" not in [tags] {
			hdfs_filter {}
		}
	} 
}

output {
	stdout { codec => rubydebug }
}
