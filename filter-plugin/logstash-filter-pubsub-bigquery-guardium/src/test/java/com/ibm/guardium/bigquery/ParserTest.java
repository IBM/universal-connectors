/*
Copyright IBM Corp. 2021, 2025 All rights reserved.
SPDX-License-Identifier: Apache-2.0
 */
package com.ibm.guardium.bigquery;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

import java.io.File;
import java.io.FileWriter;
import java.util.HashMap;
import java.util.Scanner;
import java.util.Set;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.shadow.com.univocity.parsers.csv.CsvWriter;
import org.junit.jupiter.params.shadow.com.univocity.parsers.csv.CsvWriterSettings;

import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import com.ibm.guardium.universalconnector.commons.structures.Accessor;
import com.ibm.guardium.universalconnector.commons.structures.ExceptionRecord;
import com.ibm.guardium.universalconnector.commons.structures.Record;
import com.ibm.guardium.universalconnector.commons.structures.Sentence;
import com.ibm.guardium.universalconnector.commons.structures.SessionLocator;

public class ParserTest {
	private  String gcpString2 = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"136.185.149.223\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.51 Safari\\/537.36 Edg\\/99.0.1150.39,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2efa9cd5_17fcfe7b26f\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStatus\":{\"jobState\":\"DONE\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2efa9cd5_17fcfe7b26f\",\"jobConfig\":{\"queryConfig\":{\"statementType\":\"select\",\"priority\":\"QUERY_INTERACTIVE\",\"createDisposition\":\"create_if_needed\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1b12d4043516e7fe556c67c37894adb7c0c3588b\\/tables\\/anon0d36a80a5698fbaec071061444ad0e4a4d2d2e24\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"query\":\"select * from project-sccd.Bigquerydataset_M_15Apr.nvjnfv\"},\"type\":\"QUERY\"},\"jobStats\":{\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/Newdatademo\\/tables\\/demoibm\"],\"billingTier\":1,\"totalProcessedBytes\":\"28\",\"outputRowCount\":\"2\",\"totalBilledBytes\":\"10485760\"},\"endTime\":\"2022-03-28T09:42:23.627Z\",\"createTime\":\"2022-03-28T09:42:23.237Z\",\"startTime\":\"2022-03-28T09:42:23.380Z\",\"totalSlotMs\":\"56\"}},\"after\":\"DONE\"}}},\"insertId\":\"-uso33ze1h99r\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-03-28T09:42:23.630852Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1648460543237-project-sccd:bquxjob_2efa9cd5_17fcfe7b26f\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-03-28T09:42:23.997320883Z\"}";
	final JsonObject bigQueryJson = JsonParser.parseString(gcpString2).getAsJsonObject();

	@Test
	public void testParseRecord() {
		Record record = Parser.parseRecord(bigQueryJson);
 		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
		assertNotNull(record.getDbName());
	}
 

	
	@Test
	public void testParse1RecordWithInsertStatement() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.86\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_60b6e75c_1804a2534f5\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_60b6e75c_1804a2534f5\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"insert into empDetails34(id, name, lastname) VALUES (88, (SELECT username FROM userdetail where userid =1), (SELECT username FROM userdetail where userid =1));\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-21T03:24:25.024Z\",\"startTime\":\"2022-04-21T03:24:25.152Z\",\"endTime\":\"2022-04-21T03:24:26.960Z\",\"queryStats\":{\"totalProcessedBytes\":\"50\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3854\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"31xgemde7o3\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T03:24:26.966454Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650511465024-project-sccd:bquxjob_60b6e75c_1804a2534f5\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-21T03:24:27.203011948Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
		assertNotNull(record.getDbName());
	}
	 

	
	@Test
	public void testParse2Record() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{\"code\":5,\"message\":\"syntax error\"},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.186.28\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_749ce0d9_1803b9d5d2a\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_749ce0d9_1803b9d5d2a\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"select *,userid FROM `project-sccd.BigQueryQADS.userdetail` LIMIT 465\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_f1bc17f8c4019d144c46cb14c6a5d1451b89feaf\\/tables\\/anon385493efef366d215281cd21b5dd6059410a48af\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-18T07:41:17.504Z\",\"startTime\":\"2022-04-18T07:41:17.626Z\",\"endTime\":\"2022-04-18T07:41:17.667Z\",\"queryStats\":{\"cacheHit\":true}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"tewhbneqxfpr\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-18T07:41:17.671191Z\",\"severity\":\"ERROR\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650267677504-project-sccd:bquxjob_749ce0d9_1803b9d5d2a\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-18T07:41:18.104584861Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
		assertNotNull(record.getDbName());
	}
	 

	
	@Test
	public void testParse4Record() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.26\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6d102561_1803c9b2b23\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6d102561_1803c9b2b23\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"insert into `project-sccd.BigQueryQADS.empDetails` VALUES (4, (SELECT username FROM `project-sccd.BigQueryQADS.userdetail` where userid = 1), (SELECT username FROM `project-sccd.BigQueryQADS.userdetail` where userid = 1));\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-18T12:18:31.782Z\",\"startTime\":\"2022-04-18T12:18:31.892Z\",\"endTime\":\"2022-04-18T12:18:33.810Z\",\"queryStats\":{\"totalProcessedBytes\":\"50\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3938\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-u8hckqeptdqh\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-18T12:18:33.816462Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650284311782-project-sccd:bquxjob_6d102561_1803c9b2b23\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-18T12:18:34.588366717Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
		assertNotNull(record.getDbName());
	}
	 

	
	@Test
	public void testParseCreateRecord() {
		final String gcpStringCreate = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.86\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_787f3164_1804a2c3db5\",\"metadata\":{\"jobInsertion\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobStats\":{\"createTime\":\"2022-04-21T03:32:06.081Z\",\"startTime\":\"2022-04-21T03:32:06.185Z\",\"queryStats\":{}},\"jobConfig\":{\"queryConfig\":{\"priority\":\"QUERY_INTERACTIVE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/testOne\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"query\":\"create table  `project-sccd.BigQueryQADS.testOne`  (\\r\\n  SingerId   INT64 NOT NULL,\\r\\n  FirstName  STRING(1024),\\r\\n  LastName   STRING(1024),\\r\\n  BirthDate  DATE\\r\\n)\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"CREATE_TABLE\"},\"type\":\"QUERY\"},\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_787f3164_1804a2c3db5\"}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-wq3ig5dhf0p\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T03:32:06.236284Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650511926081-project-sccd:bquxjob_787f3164_1804a2c3db5\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-21T03:32:06.413809027Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpStringCreate).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
		assertNotNull(record.getDbName());
	}
	 

	@Test
	public void testParseCreateScemaRecord() {
		final String gcpStringCreate = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.188.239\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7f9a933_1804a4c89b1\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7f9a933_1804a4c89b1\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"create schema `BigQueryQADSOne` \",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_SCHEMA\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-21T04:07:22.709Z\",\"startTime\":\"2022-04-21T04:07:22.789Z\",\"endTime\":\"2022-04-21T04:07:23.299Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"4g9i1ed9705\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T04:07:23.311914Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650514042709-project-sccd:bquxjob_7f9a933_1804a4c89b1\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-21T04:07:24.294332675Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpStringCreate).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertEquals("user@test.com", record.getAppUserName());
		assertNotNull(record.getSessionLocator());
		assertNotNull(record.getAccessor());
	}
	

	@Test
	public void testParseSessionLocator() {
		Record record = Parser.parseRecord(bigQueryJson);
		SessionLocator actual = record.getSessionLocator();
		assertNotNull(record.getSessionLocator());
		assertEquals("0.0.0.0", actual.getServerIp());
		assertEquals(-1, actual.getServerPort());
		assertEquals("136.185.149.223", actual.getClientIp());
		assertEquals(-1, actual.getClientPort());
	}

	@Test
	public void testParseAccessor() {
		Record record = Parser.parseRecord(bigQueryJson);
		Accessor actual = record.getAccessor();
		assertNotNull(record.getAccessor());
		assertEquals("project-sccd:Bigquerydataset_M_15Apr", actual.getServiceName());
		assertEquals("project-sccd_bigquery.googleapis.com", actual.getServerHostName());
		assertEquals("user@test.com", actual.getDbUser());
	}

	@Test
	public void testParseServiceData() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{\"code\":3,\"message\":\"Table \\\"userinfo\\\" must be qualified with a dataset (e.g. dataset.table).\"},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.41\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"jobservice.insert\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\",\"serviceData\":{\"@type\":\"type.googleapis.com\\/google.cloud.bigquery.logging.v1.AuditData\",\"jobInsertRequest\":{\"resource\":{\"jobName\":{\"projectId\":\"project-sccd\",\"jobId\":\"script_job_8e04c45212880e0f6ec98644318afe02_1\",\"location\":\"US\"},\"jobConfiguration\":{\"query\":{\"query\":\"create table `userinfo` (\\r\\n  SingerId   INT64 NOT NULL,\\r\\n  FirstName  STRING(1024),\\r\\n  LastName   STRING(1024),\\r\\n  SingerInfo BYTES(MAX),\\r\\n  BirthDate  DATE,\\r\\n)\",\"destinationTable\":{},\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"defaultDataset\":{},\"queryPriority\":\"QUERY_INTERACTIVE\"},\"dryRun\":true}}},\"jobInsertResponse\":{\"resource\":{\"jobName\":{},\"jobConfiguration\":{},\"jobStatus\":{\"state\":\"PENDING\",\"error\":{}},\"jobStatistics\":{}}}}},\"insertId\":\"-v2kxsgdebeq\",\"resource\":{\"type\":\"bigquery_resource\",\"labels\":{\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-21T00:17:59.819857Z\",\"severity\":\"ERROR\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"receiveTimestamp\":\"2022-04-21T00:18:00.000692125Z\"}";

		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		ExceptionRecord ex = Parser.parseException(
				"select username from `project-sccd.BigQueryQADS.userdetail` where userid =1", bigQueryJson1,
				"serviceData",bigQueryJson1.get(ApplicationConstants.PROTO_PAYLOAD).getAsJsonObject(),null);
		assertNotNull(ex);
	}

	@Test
	public void testParseSQL() {
		final String gcpString = "create table  `project-sccd.BigQueryQADS.userdetailQWO`  ("
				+ "  SingerId   INT64 NOT NULL," + "  FirstName  STRING(1024)," + "  LastName   STRING(1024),"
				+ "  BirthDate  DATE" + ");";
		assertNotNull(Parser.parseSentence(gcpString).getSentence());
	}

	@Test
	public void testParse1Event() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.214\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4b8557f_1805e3a6c28\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4b8557f_1805e3a6c28\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"insert into `project-sccd.BigQueryQADS.empDetails` (id, name, lastname)VALUES (48, (SELECT username FROM `project-sccd.BigQueryQADS.userdetail` where userid =1), (SELECT username FROM `project-sccd.BigQueryQADS.userdetail` where userid =1));\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-25T01:00:04.187Z\",\"startTime\":\"2022-04-25T01:00:04.330Z\",\"endTime\":\"2022-04-25T01:00:05.979Z\",\"queryStats\":{\"totalProcessedBytes\":\"50\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/empDetails\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"2472\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"of6x48e5kcsr\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-25T01:00:05.984535Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650848404187-project-sccd:bquxjob_4b8557f_1805e3a6c28\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T01:00:06.377547135Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertNotNull(record);
	}

	@Test
	public void testParse2Event() {
		final String gcpString = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.214\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_17cc4127_1805e3c4bd9\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_17cc4127_1805e3c4bd9\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"create table  `project-sccd.BigQueryQADS.userdetailQWO1`  (\\r\\n  SingerId   INT64 NOT NULL,\\r\\n  FirstName  STRING(1024),\\r\\n  LastName   STRING(1024),\\r\\n  BirthDate  DATE\\r\\n);\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetailQWO1\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-25T01:02:07.219Z\",\"startTime\":\"2022-04-25T01:02:07.347Z\",\"endTime\":\"2022-04-25T01:02:07.514Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"jf8vo7e9uyw8\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-25T01:02:07.523605Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650848527219-project-sccd:bquxjob_17cc4127_1805e3c4bd9\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T01:02:07.925194980Z\"}";
		final JsonObject bigQueryJson1 = JsonParser.parseString(gcpString).getAsJsonObject();
		Record record = Parser.parseRecord(bigQueryJson1);
		assertNotNull(record);
	}

	@Test
	public void testParseRecordSessionLocatorwithIPv6() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"2409:4064:2291:455c:e189:21f3:2d20:6ec5\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobChange\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals("2409:4064:2291:455c:e189:21f3:2d20:6ec5", sqlquery.getSessionLocator().getClientIpv6());
		assertEquals(-1, sqlquery.getSessionLocator().getClientPort());
		assertEquals(-1, sqlquery.getSessionLocator().getServerPort());
		assertEquals(true, sqlquery.getSessionLocator().isIpv6());
	}

	@Test
	public void testParseRecordFullSql() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.81\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobChange\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals(
				"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)  VALUES('36','Anand', 'Kumar', 'user@test.com')",
				sqlquery.getData().getConstruct().getFullSql());
	}

	@Test
	public void testParseRecordException() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{},\"requestMetadata\":{\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/97.0.4692.71 Safari\\/537.36 Edg\\/97.0.1072.62,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_51029f00_17e8b285ab4\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_51029f00_17e8b285ab4\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"select\\r\\nfrom project-sccd.BigQueryQADS.empDetails LIMIT 1000;\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobStatus\":{\"jobState\":\"DONE\",\"errorResult\":{\"code\":3,\"message\":\"Syntax error: SELECT list must not be empty at [1:8]\"},\"errors\":[{\"code\":3,\"message\":\"Syntax error: SELECT list must not be empty at [1:8]\"}]},\"jobStats\":{\"createTime\":\"2022-01-24T08:16:21.691Z\",\"startTime\":\"2022-01-24T08:16:21.713Z\",\"endTime\":\"2022-01-24T08:16:21.713Z\",\"queryStats\":{}}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"qd0pm8dxm7o\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-01-24T08:16:21.766081Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1643012181691-project-sccd:bquxjob_51029f00_17e8b285ab4\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-01-24T08:16:21.984993013Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals("SQL_ERROR", sqlquery.getException().getExceptionTypeId());
		assertEquals("Syntax error: SELECT list must not be empty at [1:8]", sqlquery.getException().getDescription());
		assertEquals("select  from project-sccd.BigQueryQADS.empDetails LIMIT 1000 ",
				sqlquery.getException().getSqlString());
	}

	@Test
	public void testParseRecordSessionLocatorWithIPv4() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.81\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobInsertion\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals(-1, sqlquery.getSessionLocator().getServerPort());
		assertEquals("0.0.0.0", sqlquery.getSessionLocator().getServerIp());
		assertEquals(-1, sqlquery.getSessionLocator().getClientPort());
		assertEquals("148.64.12.81", sqlquery.getSessionLocator().getClientIp());
		assertEquals(false, sqlquery.getSessionLocator().isIpv6());
	}

	@Test
	public void teststatementTypeParseRecordMetaData1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.81\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobInsertion\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERTED\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void teststatementTypeParseRecordMetaData2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"2409:4064:2291:455c:e189:21f3:2d20:6ec5\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobChange\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordDataTest() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.81\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobChange\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals(
				"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)  VALUES('36','Anand', 'Kumar', 'user@test.com')",
				sqlquery.getData().getConstruct().getFullSql());
		assertEquals("person", sqlquery.getData().getConstruct().sentences.get(0).getObjects().get(0).getName());
		assertEquals("collection", sqlquery.getData().getConstruct().sentences.get(0).getObjects().get(0).getType());
		assertEquals("insert", sqlquery.getData().getConstruct().sentences.get(0).getVerb().toLowerCase());
	}
	@Test
	public void testParseRecordDataTest1() {
		final String sql = "{    \"protoPayload\": {      \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",      \"status\": {},      \"authenticationInfo\": {        \"principalEmail\": \"user@test.com\"      },      \"requestMetadata\": {        \"callerIp\": \"2409:4070:2d47:fba8:5d1d:ab58:77c7:eac\",        \"callerSuppliedUserAgent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36,gzip(gfe)\",        \"requestAttributes\": {},        \"destinationAttributes\": {}      },      \"serviceName\": \"bigquery.googleapis.com\",      \"methodName\": \"google.cloud.bigquery.v2.TableService.DeleteTable\",      \"authorizationInfo\": [        {          \"resource\": \"projects/project-sccd/datasets/mydataset/tables/myothertable\",          \"permission\": \"bigquery.tables.delete\",          \"granted\": true,          \"resourceAttributes\": {}        }      ],      \"resourceName\": \"projects/project-sccd/datasets/mydataset/tables/myothertable\",      \"metadata\": {        \"@type\": \"type.googleapis.com/google.cloud.audit.BigQueryAuditMetadata\",        \"tableDeletion\": {          \"reason\": \"TABLE_DELETE_REQUEST\"        }      }    },    \"insertId\": \"-9zgy50ddtxj\",    \"resource\": {      \"type\": \"bigquery_dataset\",      \"labels\": {        \"project_id\": \"project-sccd\",        \"dataset_id\": \"mydataset\"      }    },    \"timestamp\": \"2022-11-07T06:39:21.719124Z\",    \"severity\": \"NOTICE\",    \"logName\": \"projects/project-sccd/logs/cloudaudit.googleapis.com%2Factivity\",    \"receiveTimestamp\": \"2022-11-07T06:39:21.947805447Z\"  }";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
 
	}
	
	@Test
	public void testParseRecordDataTest13() {
		String query="WITH  Items AS (SELECT out AS item_array) SELECT  item_array,  or,  uyt] AS item_ordinal, oiu AS item_safe_offset, FROM Items;";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordDataTest14() {
		String query="WITH  Items AS (SELECT [ \"coffee \",  \"tea \",  \"milk\"] AS item_array) SELECT  item_array,  item_array[OFFSET(1)] AS item_offset,  item_array[ORDINAL(1)] AS item_ordinal, item_array[SAFE_OFFSET(6)] AS item_safe_offset, FROM Items\");";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordDataTest15() {
		String query="WITH subQ1 AS (SELECT * FROM Roster WHERE SchoolID = 52), subQ2 AS (SELECT EmpID FROM Employees) SELECT DISTINCT * FROM subQ2 ";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	
	@Test
	public void testParseRecordDataTest16() {
		String query="WITH subQ1 AS (SELECT * FROM Roster WHERE SchoolID = 52), subQ2 AS (SELECT SchoolID FROM subQ1) SELECT DISTINCT * FROM subQ2";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void finalValidation() {
		String query="SELECT ARRAY_AGG(DISTINCT x) AS array_agg FROM UNNEST([2, 1, -2, 3, -2, 1, 2]) AS x";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	
	
	@Test
	public void testParseRecordDataTest19() {
		String query="WITH Values AS ( SELECT 1 x, 'a' y UNION ALL    SELECT 1 x, 'b' y UNION ALL SELECT 2 x, 'a' y UNION ALL SELECT 2 x, 'c' y SELECT x, ARRAY_AGG(y) as array_agg FROM Values GROUP BY x;";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	
	@Test
	public void testParseRecordCreateSchema() {
		String query="CREATE SCHEMA `project-sccd.my9dataset` OPTIONS( location= \"us \", default_table_expiration_days=3.75, labels=[( \"label1 \", \"value1 \"),(\"label2 \", \"value2\")]);";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	
	@Test
	public void testParseRecordUNNEST() {
		String query="Select ANY_VALUE(fruit) as any_value from UNNEST([ï¿½appleï¿½,ï¿½bananaï¿½,ï¿½pearï¿½]) as fruit";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordUNNEST1() {
		String query="WITH Items AS (SELECT [\"coffee\", \"tea\", \"milk\"] AS item_array)\r\n"
				+ "SELECT\r\n"
				+ "  item_array,\r\n"
				+ "  item_array[OFFSET(1)] AS item_offset,\r\n"
				+ "  item_array[ORDINAL(1)] AS item_ordinal,\r\n"
				+ "  item_array[SAFE_OFFSET(6)] AS item_safe_offset,\r\n"
				+ "FROM Items";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordWithNewCase() {
		String query="WITH Items AS (SELECT [ \"coffee \", \"tea \", \"milk \"] AS item_array) select 1";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordWithNewCase1() {
		String query="DECLARE JOB_START_TIMESTAMP TIMESTAMP;-- Create table books.CREATE OR REPLACE TABLE books ASSELECT 'Hamlet' title, 'William Shakespeare' author;-- Insert two rows into the books.INSERT books (title, author)VALUES('The Great Gatsby', 'F. Scott Fizgerald'),      ('War and Peace', 'Leo Tolstoy');SELECT * FROM books;SET JOB_START_TIMESTAMP = (  SELECT start_time\r\n"
				+ "  FROM `region-us`.INFORMATION_SCHEMA.JOBS_BY_USER\r\n"
				+ "  WHERE job_type=\"QUERY\"    AND statement_type=\"INSERT\"  ORDER BY start_time DESC  LIMIT 1 );-- This query only returns Hamlet, William Shakespeare as result.SELECT * FROM books FOR SYSTEM_TIME AS OF JOB_START_TIMESTAMP;";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordWithNewCases() {
		String query="WITH RECURSIVE\r\n"
				+ "  A AS (SELECT 1 AS n),\r\n"
				+ "  B AS (SELECT * FROM A)\r\n"
				+ "SELECT * FROM B";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	
	@Test
	public void testGrantQuery() {
		String query="GRANT `roles/bigquery.dataViewer` ON SCHEMA `ddldataset`\r\n"
				+ "TO \"user:user@test.com\", \"user:user@test.com\"";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testRevokeQuery() {
		String query="REVOKE `roles/bigquery.dataViewer` ON SCHEMA `ddldataset`\r\n"
				+ "FROM \"user@test.com\", \"serviceAccount:user@project-sccd.iam.gserviceaccount.com\"";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testSpecialChar() {
		String query="SELECT\r\n"
				+ "  FORMAT(\"%T\", input) AS input,\r\n"
				+ "  description,\r\n"
				+ "  FORMAT(\"%T\", NET.HOST(input)) AS host,\r\n"
				+ "  FORMAT(\"%T\", NET.PUBLIC_SUFFIX(input)) AS suffix,\r\n"
				+ "  FORMAT(\"%T\", NET.REG_DOMAIN(input)) AS domain\r\n"
				+ "FROM (\r\n"
				+ "  SELECT \"\" AS input, \"invalid input\" AS description\r\n"
				+ "  UNION ALL SELECT \"http://abc.xyz\", \"standard URL\"\r\n"
				+ "  UNION ALL SELECT \"//user:password@a.b:80/path?query\",\r\n"
				+ "                   \"standard URL with relative scheme, port, path and query, but no public suffix\"\r\n"
				+ "  UNION ALL SELECT \"https://[::1]:80\", \"standard URL with IPv6 host\"\r\n"
				+ "  UNION ALL SELECT \"http://ä¾‹å­�.å�·ç­’çº¸.ä¸­å›½\", \"standard URL with internationalized domain name\"\r\n"
				+ "  UNION ALL SELECT \"    www.Example.Co.UK    \",\r\n"
				+ "                   \"non-standard URL with spaces, upper case letters, and without scheme\"\r\n"
				+ "  UNION ALL SELECT \"mailto:?to=&subject=&body=\", \"URI rather than URL--unsupported\"\r\n"
				+ ");";
		Object sqlquery = ExecuteSqlParser.runJSEngine(query);
		assertNotNull(sqlquery);
	}
	@Test
	public void testParseRecordAccessor() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.81\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/94.0.4606.81 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"metadata\":{\"jobChange\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/big_Query_Data_Set\\/tables\\/person\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"statementType\":\"INSERT\",\"query\":\"insert into project-sccd.big_Query_Data_Set.person (id, first_name, last_name, email)\\r\\nVALUES('36','Anand', 'Kumar', 'user@test.com')\",\"priority\":\"QUERY_INTERACTIVE\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_77ace2e_17ce89f4992\",\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobStats\":{\"queryStats\":{},\"createTime\":\"2021-11-04T01:45:51.435Z\",\"startTime\":\"2021-11-04T01:45:51.532Z\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-aj7t5te11j3t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2021-11-04T01:45:51.570238Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1635990351435-project-sccd:bquxjob_77ace2e_17ce89f4992\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2021-11-04T01:45:51.713484313Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getClient_mac());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getClientHostName());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getClientOs());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getCommProtocol());
		assertEquals("CONSTRUCT", sqlquery.getAccessor().getDataType());
		assertEquals("BigQuery(GCP)", sqlquery.getAccessor().getDbProtocol());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getDbProtocolVersion());
		assertEquals("user@test.com", sqlquery.getAccessor().getDbUser());
		assertEquals("FREE_TEXT", sqlquery.getAccessor().getLanguage());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getOsUser());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getServerDescription());
		assertEquals("project-sccd_bigquery.googleapis.com", sqlquery.getAccessor().getServerHostName());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getServerOs());
		assertEquals("BigQuery", sqlquery.getAccessor().getServerType());
		assertEquals("project-sccd:big_Query_Data_Set", sqlquery.getAccessor().getServiceName());
		assertEquals(ApplicationConstants.UNKOWN_STRING, sqlquery.getAccessor().getSourceProgram());
	}

	@Test
	public void testParseRecordMetaData1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.217\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStats\":{\"createTime\":\"2022-04-25T07:03:18.503Z\",\"queryStats\":{\"cacheHit\":true},\"endTime\":\"2022-04-25T07:03:18.675Z\",\"startTime\":\"2022-04-25T07:03:18.571Z\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"queryConfig\":{\"statementType\":\"SELECT\",\"priority\":\"QUERY_INTERACTIVE\",\"query\":\"select id from User_detail_table  where first_name ='ram'\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonf1d43bd75cf4f8e9d5accd2dc18c8530e550cc66\",\"createDisposition\":\"CREATE_IF_NEEDED\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\"},\"after\":\"DONE\"}}},\"insertId\":\"-5jqjw5ebgxbc\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\"}},\"timestamp\":\"2022-04-25T07:03:18.719456Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650870198503-project-sccd:bquxjob_633b0f50_1805f8559cc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T07:03:18.964466140Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.217\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStats\":{\"createTime\":\"2022-04-25T07:03:18.503Z\",\"queryStats\":{\"cacheHit\":true},\"endTime\":\"2022-04-25T07:03:18.675Z\",\"startTime\":\"2022-04-25T07:03:18.571Z\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"queryConfig\":{\"statementType\":\"SELECT\",\"priority\":\"QUERY_INTERACTIVE\",\"query\":\"select a.id,a.name,b.salary FROM project-sccd.Bigquerydataset_M_15Apr.User_detail_table  where first_name ='ram'\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonf1d43bd75cf4f8e9d5accd2dc18c8530e550cc66\",\"createDisposition\":\"CREATE_IF_NEEDED\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\"},\"after\":\"DONE\"}}},\"insertId\":\"-5jqjw5ebgxbc\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-25T07:03:18.719456Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650870198503-project-sccd:bquxjob_633b0f50_1805f8559cc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T07:03:18.964466140Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData3() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.217\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStats\":{\"createTime\":\"2022-04-25T07:03:18.503Z\",\"queryStats\":{\"cacheHit\":true},\"endTime\":\"2022-04-25T07:03:18.675Z\",\"startTime\":\"2022-04-25T07:03:18.571Z\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"queryConfig\":{\"statementType\":\"SELECT\",\"priority\":\"QUERY_INTERACTIVE\",\"query\":\"select * from name  where first_name ='ram'\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonf1d43bd75cf4f8e9d5accd2dc18c8530e550cc66\",\"createDisposition\":\"CREATE_IF_NEEDED\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\"},\"after\":\"DONE\"}}},\"insertId\":\"-5jqjw5ebgxbc\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-25T07:03:18.719456Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650870198503-project-sccd:bquxjob_633b0f50_1805f8559cc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T07:03:18.964466140Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData4() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.41\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3a72f6d8_180497e260f\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"tableCreation\":{\"table\":{\"view\":{\"query\":\"select * from `project-sccd.BigQueryQADS.userdetail` LIMIT 1000\",\"destinationTable\":{},\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"defaultDataset\":{},\"queryPriority\":\"QUERY_INTERACTIVE\"}}}}},\"insertId\":\"-3v9ahdd5axg\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T00:21:57.986466Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650500517888-project-sccd:bquxjob_3a72f6d8_180497e260f\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-21T00:21:58.513956910Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData5() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.41\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3a72f6d8_180497e260f\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"tableChange\":{\"table\":{\"view\":{\"query\":\"select * from `project-sccd.BigQueryQADS.userdetail` LIMIT 1000\",\"destinationTable\":{},\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"defaultDataset\":{},\"queryPriority\":\"QUERY_INTERACTIVE\"}}}}},\"insertId\":\"-3v9ahdd5axg\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T00:21:57.986466Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650500517888-project-sccd:bquxjob_3a72f6d8_180497e260f\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-21T00:21:58.513956910Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData6() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.217\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStats\":{\"createTime\":\"2022-04-25T07:03:18.503Z\",\"queryStats\":{\"cacheHit\":true},\"endTime\":\"2022-04-25T07:03:18.675Z\",\"startTime\":\"2022-04-25T07:03:18.571Z\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"queryConfig\":{},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_633b0f50_1805f8559cc\"},\"after\":\"DONE\"}}},\"insertId\":\"-5jqjw5ebgxbc\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-25T07:03:18.719456Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650870198503-project-sccd:bquxjob_633b0f50_1805f8559cc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-25T07:03:18.964466140Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData7() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.184.41\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.84 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3a72f6d8_180497e260f\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"tableChange\":{\"table\":{\"view\":{\"queryed\":\"select * from `project-sccd.BigQueryQADS.userdetail` LIMIT 1000\",\"destinationTable\":{},\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"defaultDataset\":{},\"queryPriority\":\"QUERY_INTERACTIVE\"}}}}},\"insertId\":\"-3v9ahdd5axg\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-21T00:21:57.986466Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1650500517888-project-sccd:bquxjob_3a72f6d8_180497e260f\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-21T00:21:58.513956910Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithSubqueryStatement() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_406e1838_18073d7b078\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobInsertion\":{\"reason\":\"JOB_INSERT_REQUEST\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_406e1838_18073d7b078\",\"jobStats\":{\"startTime\":\"2022-04-29T05:45:43.280Z\",\"endTime\":\"2022-04-29T05:45:43.540Z\",\"createTime\":\"2022-04-29T05:45:43.222Z\",\"totalSlotMs\":\"60\",\"queryStats\":{\"outputRowCount\":\"2\",\"totalBilledBytes\":\"10485760\",\"totalProcessedBytes\":\"125\",\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\"],\"billingTier\":1}},\"jobConfig\":{\"queryConfig\":{\"statementType\":\"SELECT\",\"query\":\"select *\\r\\n  from `project-sccd.BigQueryE2E.Employee`\\r\\n  WHERE ID IN (CREATE ID\\r\\n    FROM `project-sccd.BigQueryE2E.Employe`\\r\\n    WHERE NAME = \\\"sandeep\\\") ;\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon9ad0e1ba594d00c80e88825d0ef7a43d6ad4ade6\"},\"type\":\"QUERY\"},\"jobStatus\":{\"jobState\":\"DONE\"}}}}},\"insertId\":\"ut3s3ue10omr\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-29T05:45:43.586592Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651211143222-project-sccd:bquxjob_406e1838_18073d7b078\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-29T05:45:44.594672938Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithAlter() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1b7bfe43_18073c18a2f\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1b7bfe43_18073c18a2f\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"\\r\\nalter\\r\\n TABLE `BigQueryE2E.Coude` ADD COLUMN phone string\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"ALTER_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-29T05:21:31.624Z\",\"startTime\":\"2022-04-29T05:21:31.736Z\",\"endTime\":\"2022-04-29T05:21:31.895Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\"]}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-bwxxfode8jy\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-29T05:21:31.900736Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651209691624-project-sccd:bquxjob_1b7bfe43_18073c18a2f\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-29T05:21:32.907043240Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithUpdate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"122.177.51.80\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.51 Safari\\/537.36 Edg\\/99.0.1150.39,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobConfig\":{\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"query\":\"UPDATE project-sccd.BigQueryQADS.userdetail set userid=22 where username=\\\"swe\\\";\\r\\n\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"jobStats\":{\"startTime\":\"2022-03-29T11:36:16.897Z\",\"createTime\":\"2022-03-29T11:36:16.669Z\",\"queryStats\":{}}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-vmku1oe3ayk1\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-03-29T11:36:16.965770Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1648553776669-project-sccd:bquxjob_18f056f4_17fd576596c\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-03-29T11:36:17.218515746Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithUpdate2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"122.177.51.80\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.51 Safari\\/537.36 Edg\\/99.0.1150.39,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobConfig\":{\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"query\":\"UPDATE BigQueryQADS.userdetail set userid=22 where username=\\\"swe\\\";\\r\\n\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"jobStats\":{\"startTime\":\"2022-03-29T11:36:16.897Z\",\"createTime\":\"2022-03-29T11:36:16.669Z\",\"queryStats\":{}}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-vmku1oe3ayk1\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-03-29T11:36:16.965770Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1648553776669-project-sccd:bquxjob_18f056f4_17fd576596c\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-03-29T11:36:17.218515746Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithUpdate3() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"122.177.51.80\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/99.0.4844.51 Safari\\/537.36 Edg\\/99.0.1150.39,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobStatus\":{\"jobState\":\"RUNNING\"},\"jobConfig\":{\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/userdetail\",\"query\":\"UPDATE BigQueryQADS.Order set userid=22 where username=\\\"swe\\\";\\r\\n\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"},\"type\":\"QUERY\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18f056f4_17fd576596c\",\"jobStats\":{\"startTime\":\"2022-03-29T11:36:16.897Z\",\"createTime\":\"2022-03-29T11:36:16.669Z\",\"queryStats\":{}}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-vmku1oe3ayk1\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-03-29T11:36:16.965770Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1648553776669-project-sccd:bquxjob_18f056f4_17fd576596c\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-03-29T11:36:17.218515746Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithDelete() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5ae63171_18073daa7bd\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5ae63171_18073daa7bd\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"delete from `project-sccd.BigQueryE2E.Employee` where name = \\\"xyz\\\"\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DELETE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-29T05:48:57.695Z\",\"startTime\":\"2022-04-29T05:48:57.918Z\",\"endTime\":\"2022-04-29T05:48:59.731Z\",\"queryStats\":{\"totalProcessedBytes\":\"125\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\"]},\"totalSlotMs\":\"2327\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-e5daece16299\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-29T05:48:59.737100Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651211337695-project-sccd:bquxjob_5ae63171_18073daa7bd\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-29T05:49:00.009896930Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithDelete1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5ae63171_18073daa7bd\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5ae63171_18073daa7bd\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"delete from BigQueryE2E.ordersd where name = \\\"xyz\\\"\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DELETE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-29T05:48:57.695Z\",\"startTime\":\"2022-04-29T05:48:57.918Z\",\"endTime\":\"2022-04-29T05:48:59.731Z\",\"queryStats\":{\"totalProcessedBytes\":\"125\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Employee\"]},\"totalSlotMs\":\"2327\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-e5daece16299\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-29T05:48:59.737100Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651211337695-project-sccd:bquxjob_5ae63171_18073daa7bd\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-29T05:49:00.009896930Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithExceptDistinct() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.241\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.41 Safari\\/537.36 Edg\\/101.0.1210.32,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_51b11d3b_180ac9c27ed\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_51b11d3b_180ac9c27ed\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT region_id FROM SampleBigquery.regions \\r\\nEXCEPT DISTINCT\\r\\nSELECT region_id FROM SampleBigquery.countries\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anona2a8ae949a97b063a96c0eeb112bc53ddc3a6a30\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-10T06:19:13.448Z\",\"startTime\":\"2022-05-10T06:19:13.556Z\",\"endTime\":\"2022-05-10T06:19:14.080Z\",\"queryStats\":{\"totalProcessedBytes\":\"224\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/regions\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mvied\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviewed\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviddded\"],\"referencedViews\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mvied\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviewed\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviddded\"]},\"totalSlotMs\":\"13189\"}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-hgriqaespyod\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-05-10T06:19:14.122118Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1652163553448-project-sccd:bquxjob_51b11d3b_180ac9c27ed\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-05-10T06:19:14.281073815Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithIntersectDistinct() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.241\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.41 Safari\\/537.36 Edg\\/101.0.1210.32,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5f531df8_180ac9c3d3b\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5f531df8_180ac9c3d3b\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT region_id FROM `project-sccd.SampleBigquery.regions` \\r\\nINTERSECT DISTINCT\\r\\nSELECT region_id FROM `project-sccd.SampleBigquery.countries`\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon0a064c6421481e832e19f523be937ae60d87f83f\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-10T06:19:18.926Z\",\"startTime\":\"2022-05-10T06:19:19.038Z\",\"endTime\":\"2022-05-10T06:19:19.653Z\",\"queryStats\":{\"totalProcessedBytes\":\"224\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/regions\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviddded\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mvied\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviewed\"],\"referencedViews\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviddded\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mvied\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/Mviewed\"],\"outputRowCount\":\"4\"},\"totalSlotMs\":\"16159\"}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"yosxetecxvbu\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-05-10T06:19:19.703049Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1652163558926-project-sccd:bquxjob_5f531df8_180ac9c3d3b\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-05-10T06:19:20.676685292Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithTruncate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_266c3f83_180740997f2\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_266c3f83_180740997f2\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"truncate table BigQueryQADS.TestPrf\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/TestPrf\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"TRUNCATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-29T06:40:13.884Z\",\"startTime\":\"2022-04-29T06:40:14.148Z\",\"endTime\":\"2022-04-29T06:40:15.057Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/TestPrf\"]}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"i1qxmudzz1z\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-29T06:40:15.062826Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651214413884-project-sccd:bquxjob_266c3f83_180740997f2\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-29T06:40:15.950274800Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithDrop() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.11\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3b65ef0_180740a3dd1\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3b65ef0_180740a3dd1\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"drop table BigQueryE2E.newtable;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryQADS\\/tables\\/TestProf\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DROP_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-29T06:40:56.208Z\",\"startTime\":\"2022-04-29T06:40:56.280Z\",\"endTime\":\"2022-04-29T06:40:56.415Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-s0ioxve1d2k5\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-29T06:40:56.419841Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651214456208-project-sccd:bquxjob_3b65ef0_180740a3dd1\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-29T06:40:56.702975881Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithJoin() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.166.232\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6442c9b3_18079d155ab\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6442c9b3_18079d155ab\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT R.region_name,COUNT(C.region_id) AS COUNT FROM \\r\\n SampleBigquery.regions R \\r\\nINNER Join SampleBigquery.countries C ON R.region_id = C.region_id\\r\\nGROUP BY ROLLUP(R.region_name)\\r\\nHaving count > 1\\r\\nORDER BY R.region_name\\r\\n\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon11e60e3ca775a0fb8515dd4343f5aa1308472d16\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T09:36:31.639Z\",\"startTime\":\"2022-04-30T09:36:31.752Z\",\"endTime\":\"2022-04-30T09:36:32.286Z\",\"queryStats\":{\"totalProcessedBytes\":\"272\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/regions\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/MviewOp\"],\"referencedViews\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/MviewOp\"],\"outputRowCount\":\"5\"},\"totalSlotMs\":\"287\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-il8apme37irb\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-30T09:36:32.293359Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651311391639-project-sccd:bquxjob_6442c9b3_18079d155ab\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T09:36:32.324985061Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithClauses() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.166.232\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6442c9b3_18079d155ab\",\"metadata\":{\"jobInsertion\":{\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6442c9b3_18079d155ab\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT R.region_name,COUNT(C.region_id) AS COUNT FROM `project-sccd.SampleBigquery.regions` R \\r\\nINNER Join `project-sccd.SampleBigquery.countries` C ON R.region_id = C.region_id\\r\\nGROUP BY ROLLUP(R.region_name)\\r\\nHaving count > 1\\r\\nORDER BY R.region_name\\r\\n;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon11e60e3ca775a0fb8515dd4343f5aa1308472d16\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T09:36:31.639Z\",\"startTime\":\"2022-04-30T09:36:31.752Z\",\"endTime\":\"2022-04-30T09:36:32.286Z\",\"queryStats\":{\"totalProcessedBytes\":\"272\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/regions\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/MviewOp\"],\"referencedViews\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/MviewOp\"],\"outputRowCount\":\"5\"},\"totalSlotMs\":\"287\"}},\"reason\":\"JOB_INSERT_REQUEST\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-il8apme37irl\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-30T09:36:32.326943Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651311391639-project-sccd:bquxjob_6442c9b3_18079d155ab\",\"producer\":\"bigquery.googleapis.com\",\"first\":true},\"receiveTimestamp\":\"2022-04-30T09:36:32.885700298Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithWindow() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.102\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1d6e8072_180796104fe\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1d6e8072_180796104fe\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT\\r\\n  fileName AS unique_id,\\r\\n  historyStatus AS latest_status,\\r\\n  lastUpdatedTimestamp AS last_update,\\r\\n  ROW_NUMBER() OVER (PARTITION BY fileName ORDER BY lastUpdatedTimestamp DESC) AS row_number\\r\\nFROM\\r\\n  `bigquery-public-data.fcc_political_ads.file_history`\\r\\nORDER BY\\r\\n  1,\\r\\n  3 DESC\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonbb0a98f2f0755bc674db7a4be07c8c60c902d8ac\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T07:33:51.770Z\",\"startTime\":\"2022-04-30T07:33:51.825Z\",\"endTime\":\"2022-04-30T07:34:01.119Z\",\"queryStats\":{\"totalProcessedBytes\":\"77340422\",\"totalBilledBytes\":\"77594624\",\"billingTier\":1,\"referencedTables\":[\"projects\\/bigquery-public-data\\/datasets\\/fcc_political_ads\\/tables\\/file_history\"],\"outputRowCount\":\"1553461\"},\"totalSlotMs\":\"25782\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-8l4nprekv0ao\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-30T07:34:01.123224Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651304031770-project-sccd:bquxjob_1d6e8072_180796104fe\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T07:34:01.213773282Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithCFunction() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.86\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.41 Safari\\/537.36 Edg\\/101.0.1210.32,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2d7bdc1e_180881e8685\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2d7bdc1e_180881e8685\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"create procedure ndjv.addfour(x INT64, y INT64)RETURNS FLOAT64 AS ((x + 4)\\/y);\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_FUNCTION\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-03T04:15:36.513Z\",\"startTime\":\"2022-05-03T04:15:36.607Z\",\"endTime\":\"2022-05-03T04:15:36.728Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"7s8zuqdr2w6\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-05-03T04:15:36.746227Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651551336513-project-sccd:bquxjob_2d7bdc1e_180881e8685\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-03T04:15:37.403816711Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithsnapsnot() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.71\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_23e17310_18078cf16a6\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_23e17310_18078cf16a6\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE SNAPSHOT TABLE dmldataset.mytablesnapshot\\r\\nCLONE `SampleBigquery.sampletable`\\r\\nOPTIONS(\\r\\n  expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 48 HOUR),\\r\\n  friendly_name=\\\"my_table_snapshot\\\",\\r\\n  description=\\\"A table snapshot that expires in 2 days\\\",\\r\\n  labels=[(\\\"org_unit\\\", \\\"development\\\")];\\r\\n)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/mytablesnapshot\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_SNAPSHOT_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T04:54:27.837Z\",\"startTime\":\"2022-04-30T04:54:27.978Z\",\"endTime\":\"2022-04-30T04:54:28.777Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/sampletable\"]}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-lwotzxe2yzt5\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-30T04:54:28.786926Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651294467837-project-sccd:bquxjob_23e17310_18078cf16a6\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T04:54:29.552954383Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithView() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.102\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_35690086_18079124cc0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_35690086_18079124cc0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE procedure  fdndndn.SampleBigquery.grouped(name, count) AS SELECT country_name, COUNT(*) as count\\r\\nFROM `SampleBigquery.countries.ebvhu`\\r\\ngroup by country_name;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/grouped\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_VIEW\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T06:07:52.881Z\",\"startTime\":\"2022-04-30T06:07:52.993Z\",\"endTime\":\"2022-04-30T06:07:53.167Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\"]}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"ajil5e3cncn\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-04-30T06:07:53.176764Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651298872881-project-sccd:bquxjob_35690086_18079124cc0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T06:07:53.869493480Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithInsert() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.102\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT INTO SampleBigquery.ordertt.dhamu(country_id,country_name,region_id) VALUES ('HK','HongKong',3);\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T05:34:02.175Z\",\"startTime\":\"2022-04-30T05:34:02.275Z\",\"endTime\":\"2022-04-30T05:34:03.734Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"4173\",\"parentJobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_92ef175_18078f2af08\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"qxen09ef9llm\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-30T05:34:03.742265Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651296842175-project-sccd:script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T05:34:04.042222Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithInsert1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.102\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/100.0.4896.127 Safari\\/537.36 Edg\\/100.0.1185.50,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT INTO `SampleBigquery.order`(country_id,country_name,region_id) VALUES ('HK','HongKong',3);\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-04-30T05:34:02.175Z\",\"startTime\":\"2022-04-30T05:34:02.275Z\",\"endTime\":\"2022-04-30T05:34:03.734Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/SampleBigquery\\/tables\\/countries\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"4173\",\"parentJobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_92ef175_18078f2af08\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"qxen09ef9llm\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-04-30T05:34:03.742265Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1651296842175-project-sccd:script_job_c3ac8b335ad20279f834ad7253dc56f9_11\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-04-30T05:34:04.042222Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithQualify() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.77.26\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6afbacb6_180b7a0e192\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6afbacb6_180b7a0e192\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"\\r\\nCREATE external table abcde.Call\\r\\n (\\r\\n   x INT64 OPTIONS(description=\\\"An optional INTEGER field\\\"),\\r\\n   y STRUCT<\\r\\n     a ARRAY<STRING> OPTIONS(description=\\\"A repeated STRING field\\\"),\\r\\n     b BOOL\\r\\n   >\\r\\n )\\r\\n OPTIONS(\\r\\n   expiration_timestamp=TIMESTAMP \\\"2023-01-01 00:00:00 UTC\\\",\\r\\n   description=\\\"a table that expires in 2023\\\",\\r\\n   labels=[(\\\"org_unit\\\", \\\"development\\\")]\\r\\n )\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/abcde\\/tables\\/Call\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-12T09:36:55.922Z\",\"startTime\":\"2022-05-12T09:36:56.003Z\",\"endTime\":\"2022-05-12T09:36:56.159Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-3bl3igewbd5t\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-05-12T09:36:56.166002Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1652348215922-project-sccd:bquxjob_6afbacb6_180b7a0e192\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-12T09:36:56.370481791Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithInsertInt() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.86\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.41 Safari\\/537.36 Edg\\/101.0.1210.32,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7022cdce_180bc1ee161\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7022cdce_180bc1ee161\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"create table BigQueryE2E.Meenakshi(OrderID int,Customername string(100),CustomerID int);\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/Meenakshi\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-13T06:36:23.126Z\",\"startTime\":\"2022-05-13T06:36:23.207Z\",\"endTime\":\"2022-05-13T06:36:23.347Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"skvi3ae4rwdi\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-05-13T06:36:23.355228Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1652423783126-project-sccd:bquxjob_7022cdce_180bc1ee161\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-13T06:36:23.658333429Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithselect() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.26\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.47,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7be5aa5c_180e149e407\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_7be5aa5c_180e149e407\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"SELECT * FROM `BigQueryE2E.order`;\\r\\nSELECT * FROM `BigQueryE2E.Coursed`;\\r\\nSELECT * FROM BigQueryE2E.Student_Coursed;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anoncefaa45dd9d115a8b55aa42f023cae5f90e752ee\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SCRIPT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-05-20T11:49:23.974Z\",\"startTime\":\"2022-05-20T11:49:24.041Z\",\"endTime\":\"2022-05-20T11:49:25.390Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"287t08ewy2na\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-05-20T11:49:25.393878Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1653047363974-project-sccd:bquxjob_7be5aa5c_180e149e407\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-20T11:49:25.526409913Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaData() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.131\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.53,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3523f7d7_180fb2d55fc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"job\":{\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"statementType\":\"SELECT\",\"priority\":\"QUERY_INTERACTIVE\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon7a5d84424b32d0ff95bb57bc8ae8c3bf55b424ac\",\"query\":\"SELECT A.name, item\\r\\nFROM\\r\\nUNNEST(\\r\\n[\\r\\nSTRUCT(\\r\\n'first' AS name,\\r\\n[1, 2, 3, 4] AS items),\\r\\nSTRUCT(\\r\\n'second' AS name,\\r\\n[] AS items)]) AS A\\r\\nCROSS JOIN\\r\\nA.items AS item\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3523f7d7_180fb2d55fc\",\"jobStats\":{\"startTime\":\"2022-05-25T12:28:24.639Z\",\"createTime\":\"2022-05-25T12:28:24.623Z\",\"endTime\":\"2022-05-25T12:28:24.702Z\",\"queryStats\":{\"cacheHit\":true}}},\"after\":\"DONE\"}}},\"insertId\":\"3m8gume34x29\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-05-25T12:28:24.742150Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1653481704623-project-sccd:bquxjob_3523f7d7_180fb2d55fc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-25T12:28:25.455584435Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataUnnest() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.7.87\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.53,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3c410347_1810377dccc\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"createDisposition\":\"CREATE_IF_NEEDED\",\"priority\":\"QUERY_INTERACTIVE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon3f6a9037a6e54b3e1953d443f8c5d437bd5369ba\",\"statementType\":\"SELECT\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"query\":\"SELECT ARRAY_AGG(DISTINCT x) AS array_agg FROM UNNEST([2, 1, -2, 3, -2, 1, 2]) AS x\"}},\"jobStats\":{\"queryStats\":{\"outputRowCount\":\"1\"},\"totalSlotMs\":\"456\",\"createTime\":\"2022-05-27T03:06:48.448Z\",\"startTime\":\"2022-05-27T03:06:48.465Z\",\"endTime\":\"2022-05-27T03:06:48.784Z\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3c410347_1810377dccc\"}}}},\"insertId\":\"gxq641e8wkm1\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-05-27T03:06:48.822741Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1653620808448-project-sccd:bquxjob_3c410347_1810377dccc\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-27T03:06:49.632553139Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataUnnest1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.86\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.53,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3f9feca3_180fecab4cb\",\"metadata\":{\"jobChange\":{\"job\":{\"jobStatus\":{\"jobState\":\"DONE\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3f9feca3_180fecab4cb\",\"jobStats\":{\"endTime\":\"2022-05-26T05:19:10.023Z\",\"totalSlotMs\":\"90\",\"queryStats\":{\"outputRowCount\":\"1\"},\"startTime\":\"2022-05-26T05:19:09.825Z\",\"createTime\":\"2022-05-26T05:19:09.810Z\"},\"jobConfig\":{\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonaa580b59aea559406f8e669d8941b8f0ffc3b12a\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\",\"query\":\"SELECT SUM(x) AS sum FROM UNNEST([]) AS x\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_TRUNCATE\"},\"type\":\"QUERY\"}},\"after\":\"DONE\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-m6ksu1e79wkd\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-05-26T05:19:10.052755Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1653542349810-project-sccd:bquxjob_3f9feca3_180fecab4cb\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-05-26T05:19:11.167821796Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataUnnest2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.202\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.53,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4e862711_18125427ac7\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"writeDisposition\":\"WRITE_TRUNCATE\",\"statementType\":\"SELECT\",\"query\":\"SELECT ARRAY_AGG(DISTINCT x) AS array_agg FROM UNNEST([2, 1, -2, 3, -2, 1, 2]) AS x\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"priority\":\"QUERY_INTERACTIVE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon3f6a9037a6e54b3e1953d443f8c5d437bd5369ba\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4e862711_18125427ac7\",\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"queryStats\":{\"outputRowCount\":\"1\"},\"createTime\":\"2022-06-02T16:35:39.889Z\",\"startTime\":\"2022-06-02T16:35:39.922Z\",\"totalSlotMs\":\"112\",\"endTime\":\"2022-06-02T16:35:40.216Z\"}}}}},\"insertId\":\"tf038ue2sgei\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-02T16:35:40.268654Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1654187739889-project-sccd:bquxjob_4e862711_18125427ac7\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-02T16:35:40.292430920Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataQuery() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.71\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/101.0.4951.64 Safari\\/537.36 Edg\\/101.0.1210.53,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_30ac3e17_1811eb9c2d7\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_30ac3e17_1811eb9c2d7\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"drop table `project-sccd.fruitsndvegetab`\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_SCHEMA\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-01T10:08:35.224Z\",\"startTime\":\"2022-06-01T10:08:35.294Z\",\"endTime\":\"2022-06-01T10:08:35.804Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-b3jeibell6s9\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-01T10:08:35.816547Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1654078115224-project-sccd:bquxjob_30ac3e17_1811eb9c2d7\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-01T10:08:36.557182078Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataQueryDrop() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.77.26\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.61 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_15c2dc39_1811ed72661\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_15c2dc39_1811ed72661\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"drop table  unnest.Customtable\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/testInfo\\/tables\\/Custom1\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DROP_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-01T10:37:07.441Z\",\"startTime\":\"2022-06-01T10:37:07.529Z\",\"endTime\":\"2022-06-01T10:37:07.703Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"502q0ue206ht\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-01T10:37:07.709635Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1654079827441-project-sccd:bquxjob_15c2dc39_1811ed72661\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-01T10:37:07.758524466Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataInsert() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.71\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.63 Safari\\/537.36 Edg\\/102.0.1245.39,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_75cbe4db_1815b0a1ae0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_75cbe4db_1815b0a1ae0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"insert fruitsndvegetables.Vegetable(Veg_name,Colour,Quantityinkilos) select * from unnest([('Potato','Brown',2), ('Tomato','Red',3)])\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-13T03:13:42.301Z\",\"startTime\":\"2022-06-13T03:13:42.421Z\",\"endTime\":\"2022-06-13T03:13:44.356Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\"],\"outputRowCount\":\"2\"},\"totalSlotMs\":\"3616\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"j5l39ie1zmq8\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-13T03:13:44.362807Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655090022301-project-sccd:bquxjob_75cbe4db_1815b0a1ae0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-13T03:13:45.279820332Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataInsert1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.131\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.63 Safari\\/537.36 Edg\\/102.0.1245.39,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5b52aac5_1815ceecc03\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5b52aac5_1815ceecc03\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT fruitsndvegetables.fruits VALUES('Orange','Orange',2), ('Lime','Green',4)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-13T12:03:07.557Z\",\"startTime\":\"2022-06-13T12:03:07.693Z\",\"endTime\":\"2022-06-13T12:03:11.431Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\"],\"outputRowCount\":\"2\"},\"totalSlotMs\":\"7409\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"suw39fe3809u\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-13T12:03:11.439106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655121787557-project-sccd:bquxjob_5b52aac5_1815ceecc03\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-13T12:03:11.751241089Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataDelete() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.51\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18dafcf6_1815926f205\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_18dafcf6_1815926f205\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"DELETE fruitsndvegetables.Vegetable\\r\\nWHERE Veg_name = 'Tomato'\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DELETE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-12T18:22:14.162Z\",\"startTime\":\"2022-06-12T18:22:14.436Z\",\"endTime\":\"2022-06-12T18:22:16.123Z\",\"queryStats\":{\"totalProcessedBytes\":\"420\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\"]},\"totalSlotMs\":\"2771\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-31oof2e28xey\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-12T18:22:16.130406Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655058134162-project-sccd:bquxjob_18dafcf6_1815926f205\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-12T18:22:16.314076661Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataUpdate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.51\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3d1f064e_1815b272c5d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3d1f064e_1815b272c5d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE fruitsndvegetables.Vegetable i\\r\\nSET Quantityinkilos = i.Quantityinkilos + n.Quantityinkilos\\r\\nFROM fruitsndvegetables.fruits n\\r\\nWHERE i.Veg_name = n.Fruit_name\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-13T03:41:43.597Z\",\"startTime\":\"2022-06-13T03:41:43.922Z\",\"endTime\":\"2022-06-13T03:41:45.913Z\",\"queryStats\":{\"totalProcessedBytes\":\"367\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\",\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\"]},\"totalSlotMs\":\"5076\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"nlgzrfe23b30\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-13T03:41:45.920560Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655091703597-project-sccd:bquxjob_3d1f064e_1815b272c5d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-13T03:41:46.638001868Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataSubDelete() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.26\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.63 Safari\\/537.36 Edg\\/102.0.1245.39,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4e4f2b73_18160f3c72f\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_4e4f2b73_18160f3c72f\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"DELETE fruitsndvegetables.Vegetable\\r\\nWHERE NOT EXISTS\\r\\n(SELECT * from fruitsndvegetables.fruits\\r\\nWHERE Vegetable.Veg_name = fruits.Fruit_name)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DELETE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-14T06:47:04.417Z\",\"startTime\":\"2022-06-14T06:47:04.673Z\",\"endTime\":\"2022-06-14T06:47:07.072Z\",\"queryStats\":{\"totalProcessedBytes\":\"205\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\",\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/Vegetable\"]},\"totalSlotMs\":\"5222\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-sue3v9e4m86q\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-14T06:47:07.077689Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655189224417-project-sccd:bquxjob_4e4f2b73_18160f3c72f\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-14T06:47:07.390209161Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataIndex() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.51\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/script_job_5a5d777367ebea8ed9246ea265335626_0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/script_job_5a5d777367ebea8ed9246ea265335626_0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE SEARCH INDEX my_index ON fruitsndvegetables.fruits(names ARRAY<STRING>)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits1\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-12T17:44:23.687Z\",\"startTime\":\"2022-06-12T17:44:23.768Z\",\"endTime\":\"2022-06-12T17:44:23.906Z\",\"queryStats\":{},\"parentJobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3b631a52_18159044bc8\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"6o5cnfe5yonm\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-12T17:44:23.913357Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655055863687-project-sccd:script_job_5a5d777367ebea8ed9246ea265335626_0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-12T17:44:24.226658526Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataSingleComment() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.91\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_e99c2cf_1818aa96dbb\",\"metadata\":{\"jobChange\":{\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_e99c2cf_1818aa96dbb\",\"jobStats\":{\"totalSlotMs\":\"23\",\"endTime\":\"2022-06-22T09:10:01.834Z\",\"startTime\":\"2022-06-22T09:10:01.509Z\",\"queryStats\":{\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\"],\"outputRowCount\":\"20\",\"totalProcessedBytes\":\"306\",\"totalBilledBytes\":\"10485760\"},\"createTime\":\"2022-06-22T09:10:01.425Z\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"writeDisposition\":\"WRITE_TRUNCATE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon385e32ea27929309446037a7dcca2f009b247ea4\",\"query\":\"select Fruit_name, ----------it will display first name \r\nColour from fruitsndvegetables.fruits\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"statementType\":\"SELECT\",\"priority\":\"QUERY_INTERACTIVE\"}}},\"after\":\"DONE\"},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"vn4ffze4phn2\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-22T09:10:01.906513Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655889001425-project-sccd:bquxjob_e99c2cf_1818aa96dbb\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-22T09:10:02.531136627Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataInsertEncoded() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.131\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_9cbc919_18184759208\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_9cbc919_18184759208\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT\\u00a0fruitsndvegetables.fruits VALUES('SweetLime','Green',2),\\u00a0('Chikoo','Brown',4);\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-21T04:11:48.687Z\",\"startTime\":\"2022-06-21T04:11:48.827Z\",\"endTime\":\"2022-06-21T04:11:50.722Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits\"],\"outputRowCount\":\"2\"},\"totalSlotMs\":\"4182\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-uicuvne396qc\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-21T04:11:50.729262Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655784708687-project-sccd:bquxjob_9cbc919_18184759208\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-21T04:11:51.010315404Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithCreate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.12.91\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5547e58b_1818b0d7d97\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5547e58b_1818b0d7d97\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE\\r\\n or replace TABLE\\r\\n          BigQueryE2E.newtable if not exists\\r\\n(\\r\\n  x INT64 OPTIONS(description=\\\"An optional INTEGER field\\\"),\\r\\n  y STRUCT<\\r\\n    a ARRAY<STRING> OPTIONS(description=\\\"A repeated STRING field\\\"),\\r\\n    b BOOL\\r\\n  >\\r\\n)\\r\\nPARTITION BY _PARTITIONDATE\\r\\nOPTIONS(\\r\\n  expiration_timestamp=TIMESTAMP \\\"2025-01-01 00:00:00 UTC\\\",\\r\\n  partition_expiration_days=1,\\r\\n  description=\\\"a table that expires in 2025, with each partition living for 24 hours\\\",\\r\\n  labels=[(\\\"org_unit\\\", \\\"development\\\")]\\r\\n) \",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQueryE2E\\/tables\\/newtable\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-22T10:59:19.027Z\",\"startTime\":\"2022-06-22T10:59:19.104Z\",\"endTime\":\"2022-06-22T10:59:19.251Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-4zdp3le4va91\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-22T10:59:19.258557Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655895559027-project-sccd:bquxjob_5547e58b_1818b0d7d97\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-22T10:59:19.781169820Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithCreateIfNotExists() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.51\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/script_job_5a5d777367ebea8ed9246ea265335626_0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/script_job_5a5d777367ebea8ed9246ea265335626_0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE TABLE IF NOT EXISTS        jvwegvfd.fruitsndvegetables.fruits1 (names ARRAY<STRING>)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits1\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-12T17:44:23.687Z\",\"startTime\":\"2022-06-12T17:44:23.768Z\",\"endTime\":\"2022-06-12T17:44:23.906Z\",\"queryStats\":{},\"parentJobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3b631a52_18159044bc8\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"6o5cnfe5yonm\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-12T17:44:23.913357Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655055863687-project-sccd:script_job_5a5d777367ebea8ed9246ea265335626_0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-12T17:44:24.226658526Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithEncoded() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.131\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2266d583_1818402d4be\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_2266d583_1818402d4be\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"drop\\u00a0Table projectid.fruitsndvegetables.fruits1;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/fruitsndvegetables\\/tables\\/fruits1\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"DROP_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-21T02:06:29.023Z\",\"startTime\":\"2022-06-21T02:06:29.146Z\",\"endTime\":\"2022-06-21T02:06:29.343Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-iau1g6e5ckhl\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-21T02:06:29.351462Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1655777189023-project-sccd:bquxjob_2266d583_1818402d4be\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-21T02:06:29.548620358Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithschema() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.79.131\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6b04d02e_18195afc934\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6b04d02e_18195afc934\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"drop              SCHEMA            FinalBuild1\\r\\nOPTIONS(\\r\\n  location=\\\"us\\\",\\r\\n  default_table_expiration_days=3.75,\\r\\n  labels=[(\\\"build1\\\",\\\"version1\\\"),(\\\"build2\\\",\\\"version2\\\")]\\r\\n  )\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_SCHEMA\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-24T12:28:55.421Z\",\"startTime\":\"2022-06-24T12:28:55.496Z\",\"endTime\":\"2022-06-24T12:28:56.084Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g2rt6edyzv4\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-24T12:28:56.104867Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656073735421-project-sccd:bquxjob_6b04d02e_18195afc934\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-24T12:28:56.120618505Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithschemaifNotExists() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.192\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_144a6c2d_181bd8f9b2e\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobStats\":{\"startTime\":\"2022-07-02T06:22:35.741Z\",\"queryStats\":{\"outputRowCount\":\"1\"},\"createTime\":\"2022-07-02T06:22:35.723Z\",\"totalSlotMs\":\"61\",\"endTime\":\"2022-07-02T06:22:35.903Z\"},\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"createDisposition\":\"CREATE_IF_NEEDED\",\"priority\":\"QUERY_INTERACTIVE\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anonc20cbe2d_3b22_49a9_ae5d_c97427c8273b\",\"query\":\"CREATE TEMPorary FUNCTION multiplyInputs(x FLOAT64, y FLOAT64) RETURNS FLOAT64 LANGUAGE js AS r\\\"\\\"\\\" return x*y; \\\"\\\"\\\"; SELECT multiplyInputs(a, b) FROM (SELECT 3 as a, 2 as b);\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"statementType\":\"SELECT\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_144a6c2d_181bd8f9b2e\",\"jobStatus\":{\"jobState\":\"DONE\"}}}}},\"insertId\":\"-6n950oe580et\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T06:22:35.939056Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656742955723-project-sccd:bquxjob_144a6c2d_181bd8f9b2e\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T06:22:36.559608645Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithschemaWith() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.168.80.102\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_c698ecd_181af4db532\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_3c89f6d7c8c4152e3a1a5c0ab5f855fb2bd8b6af\\/tables\\/anon2010cf7656da4da8d09be4370104eaa20884edd6\",\"priority\":\"QUERY_INTERACTIVE\",\"query\":\"WITH tmp AS (\\r\\n  SELECT id, name AS ts_hour, *\\r\\n  FROM BigQ_DatasetId_29June.fruits\\r\\n)\\r\\nSELECT ts_hour, COUNT(*) AS cnt\\r\\nFROM tmp\\r\\nGROUP BY ts_hour;\",\"writeDisposition\":\"WRITE_TRUNCATE\",\"statementType\":\"SELECT\",\"createDisposition\":\"CREATE_IF_NEEDED\"}},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_c698ecd_181af4db532\",\"jobStats\":{\"createTime\":\"2022-06-29T11:51:54.858Z\",\"endTime\":\"2022-06-29T11:51:55.192Z\",\"totalSlotMs\":\"113\",\"startTime\":\"2022-06-29T11:51:54.903Z\",\"queryStats\":{\"totalBilledBytes\":\"10485760\",\"totalProcessedBytes\":\"15\",\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigQ_DatasetId_29June\\/tables\\/fruits\"],\"billingTier\":1,\"outputRowCount\":\"2\"}},\"jobStatus\":{\"jobState\":\"DONE\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"9zsetseh9vts\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-29T11:51:55.227178Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656503514858-project-sccd:bquxjob_c698ecd_181af4db532\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-29T11:51:55.690645908Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataIf() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.168.80.41\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6ad67f80_181ae8a5792\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6ad67f80_181ae8a5792\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE capacity BigQ_DatasetId_29June.top_words\\r\\nOPTIONS(\\r\\n  description=\\\"Top ten words per Shakespeare corpus\\\"\\r\\n) AS\\r\\nSELECT\\r\\n  corpus,\\r\\n  ARRAY_AGG(STRUCT(word, word_count) ORDER BY word_count DESC LIMIT 10) AS top_words\\r\\nFROM bigquery-public-data.samples.shakespeare\\r\\nGROUP BY corpus;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigQ_DatasetId_29June\\/tables\\/top_words\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE_AS_SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-29T08:18:29.999Z\",\"startTime\":\"2022-06-29T08:18:30.107Z\",\"endTime\":\"2022-06-29T08:18:31.935Z\",\"queryStats\":{\"totalProcessedBytes\":\"5114816\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/bigquery-public-data\\/datasets\\/samples\\/tables\\/shakespeare\"],\"outputRowCount\":\"42\"},\"totalSlotMs\":\"6216\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-skjaf4e4mfgj\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-29T08:18:31.944047Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656490709999-project-sccd:bquxjob_6ad67f80_181ae8a5792\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-29T08:18:32.707542098Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataTemporary() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.165.15.38\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true},{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true},{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/script_job_a225dceff694315f8d835bb0a5549a4f_0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/script_job_a225dceff694315f8d835bb0a5549a4f_0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE  TEMP function temp_name(name STRING)\\r\\nAS\\r\\n SELECT name\\r\\n FROM `bigquery-public-data`.usa_names.usa_1910_current\\r\\n WHERE year = 2017\\r\\n ORDER BY number DESC LIMIT 100\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_script2f462ebd6458c2a75f144226341b49a2fccfea6b\\/tables\\/temp_name\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE_AS_SELECT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-30T08:17:40.981Z\",\"startTime\":\"2022-06-30T08:17:41.126Z\",\"endTime\":\"2022-06-30T08:17:42.991Z\",\"queryStats\":{\"totalProcessedBytes\":\"150693282\",\"totalBilledBytes\":\"150994944\",\"billingTier\":1,\"referencedTables\":[\"projects\\/bigquery-public-data\\/datasets\\/usa_names\\/tables\\/usa_1910_current\"],\"outputRowCount\":\"100\"},\"totalSlotMs\":\"366\",\"parentJobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6b302ea3_181b3aff099\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"hrdjxqepfaqo\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-30T08:17:43.001434Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656577060981-project-sccd:script_job_a225dceff694315f8d835bb0a5549a4f_0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-30T08:17:43.110274929Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataGrant() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.165.15.36\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_73379873_181b4dfe8e0\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_73379873_181b4dfe8e0\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"GRANT `roles\\/bigquery.dataViewer` ON table `ddldataset.nfjfj`\\r\\nTO \\\"user:user@test.com\\\", \\\"user:user@test.com\\\"\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"GRANT_ON_SCHEMA\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-30T13:49:41.929Z\",\"startTime\":\"2022-06-30T13:49:41.977Z\",\"endTime\":\"2022-06-30T13:49:42.594Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-eeu3ygecjkj3\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-06-30T13:49:42.612593Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656596981929-project-sccd:bquxjob_73379873_181b4dfe8e0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-30T13:49:43.321440107Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataRevoke() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.165.15.36\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1890b936_181b4e12279\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_1890b936_181b4e12279\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"revoke `roles\\/bigquery.dataViewer`        ON               schema                                   `ddldataset`\\r\\nFROM \\\"user@test.com\\\", \\\"serviceAccount:user@project-sccd.iam.gserviceaccount.com\\\"\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"REVOKE_ON_SCHEMA\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-06-30T13:51:02.226Z\",\"startTime\":\"2022-06-30T13:51:02.266Z\",\"endTime\":\"2022-06-30T13:51:02.832Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-c7b411cyy0\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-06-30T13:51:02.846951Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656597062226-project-sccd:bquxjob_1890b936_181b4e12279\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-06-30T13:51:03.291354757Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithInsertCurrent() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"157.48.152.241\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_782ca949_181c9a17bb4\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_782ca949_181c9a17bb4\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT ddldataset.DetailedInventory\\r\\nVALUES('top load washer', 10, FALSE, [(CURRENT_DATE(), \\\"comment1\\\")], (\\\"white\\\",\\\"1 year\\\",(30,40,28))),\\r\\n      ('front load washer', 20, FALSE, [(CURRENT_DATE(), \\\"comment1\\\")], (\\\"beige\\\",\\\"1 year\\\",(35,45,30)))\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-04T14:33:32.090Z\",\"startTime\":\"2022-07-04T14:33:32.240Z\",\"endTime\":\"2022-07-04T14:33:33.697Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\"],\"outputRowCount\":\"2\"},\"totalSlotMs\":\"3757\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-nuu0nge58x5e\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-04T14:33:33.702227Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656945212090-project-sccd:bquxjob_782ca949_181c9a17bb4\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-04T14:33:34.186353651Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithStructInsert() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3d62388c_181fb84c97e\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3d62388c_181fb84c97e\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT INTO project-sccd.BigqueryDemo.studented (rollNo, info) VALUES (1,STRUCT(\\\"Yash\\\",26,\\\"Mechanical Engineering\\\"))\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/studented\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-14T07:07:21.049Z\",\"startTime\":\"2022-07-14T07:07:21.173Z\",\"endTime\":\"2022-07-14T07:07:22.902Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/studented\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3905\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"b3zablefdfgy\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-14T07:07:22.907682Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657782441049-project-sccd:bquxjob_3d62388c_181fb84c97e\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T07:07:22.975022183Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithStructCreate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6b7df308_181fb7fa8de\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_6b7df308_181fb7fa8de\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"CREATE TABLE project-sccd.BigqueryDemo.students\\r\\n (\\r\\n   rollNo INT OPTIONS(description=\\\"The identifier for each student\\\"),\\r\\n   info STRUCT<\\r\\n     name STRING,\\r\\n     age INT,\\r\\n     department STRING\\r\\n   >\\r\\n )\\r\\n OPTIONS(\\r\\n   expiration_timestamp=TIMESTAMP \\\"2021-10-07 00:00:00 UTC\\\",\\r\\n   description=\\\"Table with a struct column\\\"\\r\\n )\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/students\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"CREATE_TABLE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-14T07:01:45.070Z\",\"startTime\":\"2022-07-14T07:01:45.156Z\",\"endTime\":\"2022-07-14T07:01:45.293Z\",\"queryStats\":{}}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-9f7ermepy4gp\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-14T07:01:45.301077Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657782105070-project-sccd:bquxjob_6b7df308_181fb7fa8de\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T07:01:46.008461524Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithStructSelect() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_990c91d_181fbb313a0\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobConfig\":{\"queryConfig\":{\"writeDisposition\":\"WRITE_TRUNCATE\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/_1f1c36c3ea0388eeb7a982fdeb3f5cbaed5b427a\\/tables\\/anon3829c73782de65298190525924138456789a5cb2\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"SELECT\",\"query\":\" with a as (\\r\\nselect [struct(\\\"current\\\" as status,\\\"London\\\" as address, \\\"ABC123D\\\" as postcode, struct(\\\"yes\\\" as owner, \\\"no\\\" as tenant) as resident, \\r\\n        [\\\"3 bedroom\\\",\\\"kitchen\\\",\\\"living room\\\",\\\"garden\\\"] as rooms),\\r\\n        struct(\\\"previous\\\" as status,\\\"New Delhi\\\" as address, \\\"738497\\\" as postcode, struct(\\\"yes\\\" as owner, \\\"no\\\" as tenant) as resident, \\r\\n        [\\\"2 bedroom\\\",\\\"kitchen\\\",\\\"living room\\\"] as rooms),\\r\\n        struct(\\\"birth\\\" as status,\\\"New York\\\" as address, \\\"SHI747H\\\" as postcode, struct(\\\"yes\\\" as owner, \\\"no\\\" as tenant) as resident, \\r\\n        [\\\"4 bedroom\\\",\\\"kitchen\\\",\\\"living room\\\"] as rooms)]as address_history\\r\\n)\\r\\nselect status,postcode, resident, rooms\\r\\nfrom a,\\r\\nunnest (address_history) as addr,\\r\\nunnest (rooms) as rooms;\"},\"type\":\"QUERY\"},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"totalSlotMs\":\"59\",\"startTime\":\"2022-07-14T07:57:54.746Z\",\"queryStats\":{\"outputRowCount\":\"10\"},\"createTime\":\"2022-07-14T07:57:54.731Z\",\"endTime\":\"2022-07-14T07:57:54.914Z\"},\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_990c91d_181fbb313a0\"}}}},\"insertId\":\"-vwhqcme1m1vp\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-14T07:57:54.959974Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657785474731-project-sccd:bquxjob_990c91d_181fbb313a0\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T07:57:55.392443271Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithNestedInsert() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3f70dea9_181fc059130\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_3f70dea9_181fc059130\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT INTO project-sccd.BigqueryDemo.nestedquery  VALUES (1,STRUCT(\\\"Yash\\\",26,STRUCT(\\\"Mechanical Engineering\\\",101)))\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/nestedquery\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-14T09:28:00.983Z\",\"startTime\":\"2022-07-14T09:28:01.114Z\",\"endTime\":\"2022-07-14T09:28:02.520Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/nestedquery\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3076\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-f8x22ueacge3\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-14T09:28:02.526171Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657790880983-project-sccd:bquxjob_3f70dea9_181fc059130\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T09:28:03.541779251Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithNested() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_477d693e_181fc181437\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_477d693e_181fc181437\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"INSERT INTO project-sccd.BigqueryDemo.nestedinser VALUES (1,STRUCT(\\\"Yash\\\",26,STRUCT(\\\"Mechanical Engineering\\\",101,STRUCT(\\\"CSV\\\",102))))\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/nestedinser\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"INSERT\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-14T09:48:14.191Z\",\"startTime\":\"2022-07-14T09:48:14.322Z\",\"endTime\":\"2022-07-14T09:48:15.880Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/nestedinser\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3888\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-jys4qmeidlmu\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-14T09:48:15.886107Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657792094191-project-sccd:bquxjob_477d693e_181fc181437\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T09:48:15.940596919Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithStructUpdate() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_ecc994_181fc758f34\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_ecc994_181fc758f34\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE BigqueryDemo.studented\\r\\nSET info = struct(\\\"dhamodhar\\\",33,\\\"CSE\\\")\\r\\nWHERE rollNo = 2\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/studented\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-14T11:30:20.438Z\",\"startTime\":\"2022-07-14T11:30:20.785Z\",\"endTime\":\"2022-07-14T11:30:22.644Z\",\"queryStats\":{\"totalProcessedBytes\":\"162\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/studented\"],\"outputRowCount\":\"1\"},\"totalSlotMs\":\"3292\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"hrgdy7eo6fis\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-14T11:30:22.649190Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1657798220438-project-sccd:bquxjob_ecc994_181fc758f34\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-14T11:30:23.586527422Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithUpdateStruct() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.105\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.5060.114 Safari\\/537.36 Edg\\/103.0.1264.49,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_12836584_1820aa5bbad\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_12836584_1820aa5bbad\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE ddldataset.DetailedInventoryss\\r\\nSET specifications = ARRAY<STRUCT<color STRING, warranty STRING, \\r\\n                    dimensions STRUCT<depth FLOAT64, height FLOAT64, width FLOAT64>>>\\r\\n                    [('white', '1 year', NULL)]\\r\\nWHERE product like '%washer%'\\r\\n\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventoryss\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-17T05:37:41.939Z\",\"startTime\":\"2022-07-17T05:37:42.174Z\",\"endTime\":\"2022-07-17T05:37:43.786Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventoryss\"]},\"totalSlotMs\":\"3046\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"uss5ksecuur8\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-17T05:37:43.802127Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1658036261939-project-sccd:bquxjob_12836584_1820aa5bbad\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-17T05:37:44.291494915Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithUpdateStruct1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.105\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.5060.114 Safari\\/537.36 Edg\\/103.0.1264.49,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5a6d1a6d_1820a9f0e72\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_5a6d1a6d_1820a9f0e72\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE ddldataset.DetailedInventorys\\r\\nSET comments = STRUCT<created DATE, comment STRING>('2016-01-01', 'comment1')\\r\\nWHERE product like '%washer%'\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventorys\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-17T05:30:24.445Z\",\"startTime\":\"2022-07-17T05:30:24.692Z\",\"endTime\":\"2022-07-17T05:30:26.332Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventorys\"]},\"totalSlotMs\":\"2639\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-sunt4eeezokw\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-17T05:30:26.337529Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1658035824445-project-sccd:bquxjob_5a6d1a6d_1820a9f0e72\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-17T05:30:26.464719761Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithUpdateStruct2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.105\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.5060.114 Safari\\/537.36 Edg\\/103.0.1264.49,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_546de820_1820a91cfb6\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_546de820_1820a91cfb6\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE ddldataset.DetailedInventory\\r\\nSET specifications = STRUCT<color STRING, warranty STRING,dimensions STRUCT<depth FLOAT64, height FLOAT64, width FLOAT64>>(\\\"white\\\", \\\"1 year\\\", (30,40,28)) WHERE product like '%washer%'\\r\\n\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-17T05:15:55.822Z\",\"startTime\":\"2022-07-17T05:15:56.108Z\",\"endTime\":\"2022-07-17T05:15:57.769Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\"]},\"totalSlotMs\":\"3900\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-t4plooe7bsvx\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-17T05:15:57.777400Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1658034955822-project-sccd:bquxjob_546de820_1820a91cfb6\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-17T05:15:57.928459682Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithUpdateStruct3() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"148.64.5.105\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.5060.114 Safari\\/537.36 Edg\\/103.0.1264.49,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_24cb87c8_1820a92d59d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_24cb87c8_1820a92d59d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE ddldataset.DetailedInventory\\r\\nSET comments = ARRAY<STRUCT<created DATE, comment STRING>>[(CAST('2016-01-01' AS DATE), 'comment1')]\\r\\nWHERE product like '%washer%'\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-17T05:17:02.706Z\",\"startTime\":\"2022-07-17T05:17:02.961Z\",\"endTime\":\"2022-07-17T05:17:04.578Z\",\"queryStats\":{\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/DetailedInventory\"]},\"totalSlotMs\":\"3236\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"opim08e2nzuk\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"project_id\":\"project-sccd\",\"location\":\"US\"}},\"timestamp\":\"2022-07-17T05:17:04.584543Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1658035022706-project-sccd:bquxjob_24cb87c8_1820a92d59d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-17T05:17:04.975020207Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge1() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE ddldataset.Inventory USING nfnfnf.jnjnd\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\nupdate SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\nINSERT (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge2() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE dataset.Inventory as t USING (                                        select * from unnest)\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\ninsert SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\ndelete (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge3() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE ddldataset.Inventory \\r\\nUSING nfnfnf.jnjnd\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\nUPDATE SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\ndelete (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge4() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE  ddldataset.Inventory t USING (  select * from hfhhf)\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\nUPDATE SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\ndelete (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge5() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE  ddldataset.Inventory T\\r\\nUSING nfnfnf.jnjnd\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\ninsert SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\ndelete (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithMerge6() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE  ddldataset.Inventory \\r\\nUSING (select * from hfhhf)\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\ninsert SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\ndelete (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge7() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE into ddldataset.Inventory as t  USING nfnfnf.jnjnd\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\ninsert SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\n (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithMerge8() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE ddldataset.Inventory as t USING (      select * from hfhhf)\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\ninsert SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\n (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge9() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE ddldataset.Inventory t USING nfnfnf.jnjnd\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\nupdate SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\n (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);
	}

	@Test
	public void testParseRecordMetaDataWithMerge10() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE  ddldataset.Inventory \\r\\nUSING ( select * from )\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\n SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\n (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithMerge11() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"168.149.165.1\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/102.0.5005.124 Safari\\/537.36 Edg\\/102.0.1245.44,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_779d6a8b_181bcb2a44d\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"MERGE  ddldataset.Inventory \\r\\nUSING rjrjrj.jnjnf\\r\\nON T.product = S.product\\r\\nWHEN MATCHED THEN\\r\\n SET quantity = T.quantity + S.quantity\\r\\nWHEN NOT MATCHED THEN\\r\\n (product, quantity) VALUES(product, quantity)\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"MERGE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-07-02T02:21:15.251Z\",\"startTime\":\"2022-07-02T02:21:15.492Z\",\"endTime\":\"2022-07-02T02:21:17.869Z\",\"queryStats\":{\"totalProcessedBytes\":\"196\",\"totalBilledBytes\":\"20971520\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/Inventory\",\"projects\\/project-sccd\\/datasets\\/ddldataset\\/tables\\/NewArrivals\"],\"outputRowCount\":\"3\"},\"totalSlotMs\":\"11325\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"-g3adezdulco\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-02T02:21:17.874106Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1656728475251-project-sccd:bquxjob_779d6a8b_181bcb2a44d\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-07-02T02:21:18.499328981Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithTableInsert() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"serviceaccount-vikas@project-sccd.iam.gserviceaccount.com\",\"serviceAccountKeyName\":\"\\/\\/iam.googleapis.com\\/projects\\/project-sccd\\/serviceAccounts\\/serviceaccount-vikas@project-sccd.iam.gserviceaccount.com\\/keys\\/d42132726c84b24e4f7a6e8d1664c440f79fd99d\"},\"requestMetadata\":{\"callerIp\":\"129.41.87.5\",\"callerSuppliedUserAgent\":\"gcloud-java\\/2.0.0 Google-API-Java-Client\\/1.33.1 Google-HTTP-Java-Client\\/1.41.4 (gzip),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.TableService.InsertTable\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\\/datasets\\/BigQuery_AutomationDataset\",\"permission\":\"bigquery.tables.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/datasets\\/BigQuery_AutomationDataset\\/tables\\/BigQuery_AutomationTable\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"tableCreation\":{\"reason\":\"TABLE_INSERT_REQUEST\",\"table\":{\"createTime\":\"2022-07-11T11:30:41.656Z\",\"schemaJson\":\"{\\n  \\\"fields\\\": [{\\n    \\\"name\\\": \\\"ID\\\",\\n    \\\"type\\\": \\\"STRING\\\",\\n    \\\"mode\\\": \\\"NULLABLE\\\"\\n  }, {\\n    \\\"name\\\": \\\"isPresent\\\",\\n    \\\"type\\\": \\\"BOOLEAN\\\",\\n    \\\"mode\\\": \\\"NULLABLE\\\"\\n  }, {\\n    \\\"name\\\": \\\"accountNumber\\\",\\n    \\\"type\\\": \\\"INTEGER\\\",\\n    \\\"mode\\\": \\\"NULLABLE\\\"\\n  }]\\n}\",\"updateTime\":\"2022-07-11T11:30:41.691Z\",\"tableName\":\"projects\\/project-sccd\\/datasets\\/BigQuery_AutomationDataset\\/tables\\/BigQuery_AutomationTable\"}}}},\"insertId\":\"-qmhzpwd9f7o\",\"resource\":{\"type\":\"bigquery_dataset\",\"labels\":{\"project_id\":\"project-sccd\",\"dataset_id\":\"BigQuery_AutomationDataset\"}},\"timestamp\":\"2022-07-11T11:30:41.731439Z\",\"severity\":\"NOTICE\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Factivity\",\"receiveTimestamp\":\"2022-07-11T11:30:42.512973757Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithTableDelete() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"223.233.64.98\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/103.0.0.0 Safari\\/537.36,gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.TableService.DeleteTable\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/Channels\",\"permission\":\"bigquery.tables.delete\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/datasets\\/BigqueryDemo\\/tables\\/Channels\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"tableDeletion\":{\"reason\":\"TABLE_DELETE_REQUEST\"}}},\"insertId\":\"-ooj6w2df9md\",\"resource\":{\"type\":\"bigquery_dataset\",\"labels\":{\"dataset_id\":\"BigqueryDemo\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-11T10:29:40.350784Z\",\"severity\":\"NOTICE\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Factivity\",\"receiveTimestamp\":\"2022-07-11T10:29:40.629050688Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithDatasetCreation() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"serviceaccount-vikas@project-sccd.iam.gserviceaccount.com\",\"serviceAccountKeyName\":\"\\/\\/iam.googleapis.com\\/projects\\/project-sccd\\/serviceAccounts\\/serviceaccount-vikas@project-sccd.iam.gserviceaccount.com\\/keys\\/d42132726c84b24e4f7a6e8d1664c440f79fd99d\"},\"requestMetadata\":{\"callerIp\":\"129.41.87.5\",\"callerSuppliedUserAgent\":\"gcloud-java\\/2.0.0 Google-API-Java-Client\\/1.33.1 Google-HTTP-Java-Client\\/1.41.4 (gzip),gzip(gfe)\",\"requestAttributes\":{},\"destinationAttributes\":{}},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.DatasetService.InsertDataset\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.datasets.create\",\"granted\":true,\"resourceAttributes\":{}}],\"resourceName\":\"projects\\/project-sccd\\/datasets\\/BigQuery_AutomationDataset\",\"metadata\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\",\"datasetCreation\":{\"reason\":\"CREATE\",\"dataset\":{\"updateTime\":\"2022-07-11T11:30:41.137Z\",\"createTime\":\"2022-07-11T11:30:41.137Z\",\"datasetName\":\"projects\\/project-sccd\\/datasets\\/BigQuery_AutomationDataset\",\"acl\":{\"policy\":{\"bindings\":[{\"members\":[\"projectEditor:project-sccd\"],\"role\":\"roles\\/bigquery.dataEditor\"},{\"members\":[\"projectOwner:project-sccd\",\"serviceAccount:serviceaccount-vikas@project-sccd.iam.gserviceaccount.com\"],\"role\":\"roles\\/bigquery.dataOwner\"},{\"members\":[\"projectViewer:project-sccd\"],\"role\":\"roles\\/bigquery.dataViewer\"}]}}}}}},\"insertId\":\"-ooouh2d45c8\",\"resource\":{\"type\":\"bigquery_dataset\",\"labels\":{\"dataset_id\":\"BigQuery_AutomationDataset\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-07-11T11:30:41.204965Z\",\"severity\":\"NOTICE\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Factivity\",\"receiveTimestamp\":\"2022-07-11T11:30:41.870795018Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

	@Test
	public void testParseRecordMetaDataWithDatasetDeletion() {
		final String sql = "{\"protoPayload\":{\"@type\":\"type.googleapis.com\\/google.cloud.audit.AuditLog\",\"status\":{},\"authenticationInfo\":{\"principalEmail\":\"user@test.com\"},\"requestMetadata\":{\"callerIp\":\"103.168.81.160\",\"callerSuppliedUserAgent\":\"Mozilla\\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\\/537.36 (KHTML, like Gecko) Chrome\\/107.0.0.0 Safari\\/537.36,gzip(gfe),gzip(gfe)\"},\"serviceName\":\"bigquery.googleapis.com\",\"methodName\":\"google.cloud.bigquery.v2.JobService.InsertJob\",\"authorizationInfo\":[{\"resource\":\"projects\\/project-sccd\",\"permission\":\"bigquery.jobs.create\",\"granted\":true}],\"resourceName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_35ae7ecb_1845206c981\",\"metadata\":{\"jobChange\":{\"after\":\"DONE\",\"job\":{\"jobName\":\"projects\\/project-sccd\\/jobs\\/bquxjob_35ae7ecb_1845206c981\",\"jobConfig\":{\"type\":\"QUERY\",\"queryConfig\":{\"query\":\"UPDATE dataset.DetailedInventory SET comments = ARRAY( SELECT c FROM UNNEST(comments) AS c WHERE c.comment NOT LIKE '%comment2%' ) WHERE true;\",\"destinationTable\":\"projects\\/project-sccd\\/datasets\\/dataset\\/tables\\/DetailedInventory\",\"createDisposition\":\"CREATE_IF_NEEDED\",\"writeDisposition\":\"WRITE_EMPTY\",\"priority\":\"QUERY_INTERACTIVE\",\"statementType\":\"UPDATE\"}},\"jobStatus\":{\"jobState\":\"DONE\"},\"jobStats\":{\"createTime\":\"2022-11-07T12:18:07.707Z\",\"startTime\":\"2022-11-07T12:18:08.017Z\",\"endTime\":\"2022-11-07T12:18:10.227Z\",\"queryStats\":{\"totalProcessedBytes\":\"298\",\"totalBilledBytes\":\"10485760\",\"billingTier\":1,\"referencedTables\":[\"projects\\/project-sccd\\/datasets\\/dataset\\/tables\\/DetailedInventory\"],\"outputRowCount\":\"14\"},\"totalSlotMs\":\"4105\"}}},\"@type\":\"type.googleapis.com\\/google.cloud.audit.BigQueryAuditMetadata\"}},\"insertId\":\"nv235ie8z18x\",\"resource\":{\"type\":\"bigquery_project\",\"labels\":{\"location\":\"US\",\"project_id\":\"project-sccd\"}},\"timestamp\":\"2022-11-07T12:18:10.232333Z\",\"severity\":\"INFO\",\"logName\":\"projects\\/project-sccd\\/logs\\/cloudaudit.googleapis.com%2Fdata_access\",\"operation\":{\"id\":\"1667823487707-project-sccd:bquxjob_35ae7ecb_1845206c981\",\"producer\":\"bigquery.googleapis.com\",\"last\":true},\"receiveTimestamp\":\"2022-11-07T12:18:10.570748804Z\"}";
		final JsonObject BigqueryJson = JsonParser.parseString(sql).getAsJsonObject();
		Record sqlquery = Parser.parseRecord(BigqueryJson);
		assertNotNull(sqlquery);

	}

}
