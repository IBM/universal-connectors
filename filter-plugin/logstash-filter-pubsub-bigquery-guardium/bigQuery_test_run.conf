input {
	generator {
		type => "bigQuery"
		lines =>[
		"{'protoPayload':{'@type':'type.googleapis.com\/google.cloud.audit.AuditLog','status':{},'authenticationInfo':{},'requestMetadata':{'callerSuppliedUserAgent':'Mozilla\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/97.0.4692.71 Safari\/537.36,gzip(gfe),gzip(gfe)'},'serviceName':'bigquery.googleapis.com','methodName':'google.cloud.bigquery.v2.JobService.InsertJob','resourceName':'projects\/project-sccd\/jobs\/bquxjob_550452b_17e6cc9ec43','metadata':{'jobInsertion':{'job':{'jobName':'projects\/project-sccd\/jobs\/bquxjob_550452b_17e6cc9ec43','jobConfig':{'type':'QUERY','queryConfig':{'query':'SELECT *  FROM `project-sccd.BigQueryE2E.Employee` LIMIT 1000','destinationTable':'projects\/project-sccd\/datasets\/_941fe07b12a19863d84dfc72e8a1bdb984f7ca12\/tables\/anon3b5369325e0ddc99b0954f2ac9399fb2359f4582','createDisposition':'CREATE_IF_NEEDED','writeDisposition':'WRITE_TRUNCATE','priority':'QUERY_INTERACTIVE','statementType':'SELECT'}},'jobStatus':{'jobState':'RUNNING'},'jobStats':{'createTime':'2022-01-18T10:44:25.377Z','startTime':'2022-01-18T10:44:25.503Z','queryStats':{}}},'reason':'JOB_INSERT_REQUEST'},'@type':'type.googleapis.com\/google.cloud.audit.BigQueryAuditMetadata'}},'insertId':'z8mbr9e6dz5b','resource':{'type':'bigquery_project','labels':{'project_id':'project-sccd','location':'US'}},'timestamp':'2022-01-18T10:44:25.546717Z','severity':'INFO','logName':'projects\/project-sccd\/logs\/cloudaudit.googleapis.com%2Fdata_access','operation':{'id':'1642502665377-project-sccd:bquxjob_550452b_17e6cc9ec43','producer':'bigquery.googleapis.com','first':true},'receiveTimestamp':'2022-01-18T10:44:25.973173610Z'}",
        "{'protoPayload': {'@type': 'type.googleapis.com\/google.cloud.audit.AuditLog', 'status': { 'code': 3, 'message': 'Table \'GuardDB0102_1800_0001\' must be qualified with a dataset (e.g. dataset.table).' }, 'authenticationInfo': { 'principalEmail': 'apurva.birajdar@ibm.com' }, 'requestMetadata': { 'callerIp': '106.216.241.99', 'callerSuppliedUserAgent': 'Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/121.0.0.0 Safari\/537.36, 'requestAttributes': {}, 'destinationAttributes': {} }, 'serviceName': 'bigquery.googleapis.com', 'methodName': 'jobservice.insert', 'authorizationInfo': [ { 'resource': 'projects\/charged-mind-281913', 'permission': 'bigquery.jobs.create', 'granted': true, 'resourceAttributes': {} } ], 'resourceName': 'projects\/charged-mind-281913\/jobs', 'serviceData': { '@type': 'type.googleapis.com\/google.cloud.bigquery.logging.v1.AuditData', 'jobInsertRequest': { 'resource': { 'jobName': { 'projectId': 'charged-mind-281913', 'jobId': 'script_job_79b0d4c66a8a0404deb61ceb4c01e072_0', 'location': 'US' }, 'jobConfiguration': { 'query': { 'query': 'CREATE TABLE GuardDB0102_1800_0001(id int, tutorial_name varchar(50))', 'destinationTable': {}, 'createDisposition': 'CREATE_IF_NEEDED', 'writeDisposition': 'WRITE_EMPTY', 'defaultDataset': {}, 'queryPriority': 'QUERY_INTERACTIVE' }, 'dryRun': true } } }, 'jobInsertResponse': { 'resource': { 'jobName': {}, 'jobConfiguration': {}, 'jobStatus': { 'state': 'PENDING', 'error': {} }, 'jobStatistics': { 'reservation': 'unreserved' } } } } }, 'insertId': 'dlqb3ue1j04c', 'resource': { 'type': 'bigquery_resource', 'labels': { 'project_id': 'charged-mind-281913' } }, 'timestamp': '2024-02-02T07:51:15.575336Z', 'severity': 'ERROR', 'logName': 'projects\/charged-mind-281913\/logs\/cloudaudit.googleapis.com%2Fdata_access', 'receiveTimestamp': '2024-02-02T07:51:16.020841882Z'}"
		]
		count => 1
	}
}

filter{
	if [type] == "bigQuery" {
		big_query_guardium_filter {}
	}
}


output 
{
	stdout { codec => rubydebug }
}