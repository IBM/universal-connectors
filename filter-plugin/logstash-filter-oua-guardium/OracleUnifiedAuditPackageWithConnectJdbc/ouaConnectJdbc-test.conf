#/*
#Copyright 2023-24 IBM Inc. - All Rights Reserved.
#SPDX-License-Identifier: Apache-2.0
#*/

input {
  generator {
    lines => [
      '{"schema":{"type":"struct","fields":[{"type":"int64","optional":true,"name":"org.apache.kafka.connect.data.Timestamp","version":1,"field":"EVENT_TIMESTAMP_UTC"},{"type":"string","optional":true,"field":"SESSIONID"},{"type":"string","optional":true,"field":"USERID"},{"type":"string","optional":true,"field":"CON_NAME"},{"type":"string","optional":true,"field":"OS_USER"},{"type":"string","optional":true,"field":"CLIENT_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_HOST_NAME"},{"type":"string","optional":true,"field":"SERVER_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_PROGRAM_NAME"},{"type":"string","optional":true,"field":"DBID"},{"type":"string","optional":true,"field":"DBNAME"},{"type":"string","optional":true,"field":"RETURN_CODE"},{"type":"string","optional":true,"field":"SQL_TEXT"}],"optional":false},"payload":{"EVENT_TIMESTAMP_UTC":1716303794152,"SESSIONID":"2967627425","USERID":"SUPERUSER","CON_NAME":"TESTDB","OS_USER":"Administrator","CLIENT_HOST_IP":"129.41.87.3","CLIENT_HOST_NAME":"sys-auto-fyre-ws161","SERVER_HOST_IP":"127.0.0.1","CLIENT_PROGRAM_NAME":"JDBC Thin Client","DBID":"2951224659","DBNAME":"TESTDB","RETURN_CODE":"0","SQL_TEXT":"INSERT INTO ACCOUNT_MASTER_SHOP_ACCOUNT_MASTER_DEPARTMENT(DEALER,ARTICLE ,PRICE) VALUES('D',4,19.95)\u0000"}}', #INSERT
      '{"schema":{"type":"struct","fields":[{"type":"int64","optional":true,"name":"org.apache.kafka.connect.data.Timestamp","version":1,"field":"EVENT_TIMESTAMP_UTC"},{"type":"string","optional":true,"field":"SESSIONID"},{"type":"string","optional":true,"field":"USERID"},{"type":"string","optional":true,"field":"CON_NAME"},{"type":"string","optional":true,"field":"OS_USER"},{"type":"string","optional":true,"field":"CLIENT_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_HOST_NAME"},{"type":"string","optional":true,"field":"SERVER_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_PROGRAM_NAME"},{"type":"string","optional":true,"field":"DBID"},{"type":"string","optional":true,"field":"DBNAME"},{"type":"string","optional":true,"field":"RETURN_CODE"},{"type":"string","optional":true,"field":"SQL_TEXT"}],"optional":false},"payload":{"EVENT_TIMESTAMP_UTC":1716217082712,"SESSIONID":"788787356","USERID":"SUPERUSER","CON_NAME":"TESTDB","OS_USER":"Administrator","CLIENT_HOST_IP":"170.225.223.20","CLIENT_HOST_NAME":"sys-auto-fyre-ws91","SERVER_HOST_IP":"127.0.0.1","CLIENT_PROGRAM_NAME":"JDBC Thin Client","DBID":"2951224659","DBNAME":"TESTDB","RETURN_CODE":"0","SQL_TEXT":"DELETE FROM ACCOUNT_MASTER_SUPPLIERS_ACCOUNT_MASTER_DEPARTMENT WHERE SUPPLIERID IN('501')\u0000"}}', #DELETE
      '{"schema":{"type":"struct","fields":[{"type":"int64","optional":true,"name":"org.apache.kafka.connect.data.Timestamp","version":1,"field":"EVENT_TIMESTAMP_UTC"},{"type":"string","optional":true,"field":"SESSIONID"},{"type":"string","optional":true,"field":"USERID"},{"type":"string","optional":true,"field":"CON_NAME"},{"type":"string","optional":true,"field":"OS_USER"},{"type":"string","optional":true,"field":"CLIENT_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_HOST_NAME"},{"type":"string","optional":true,"field":"SERVER_HOST_IP"},{"type":"string","optional":true,"field":"CLIENT_PROGRAM_NAME"},{"type":"string","optional":true,"field":"DBID"},{"type":"string","optional":true,"field":"DBNAME"},{"type":"string","optional":true,"field":"RETURN_CODE"},{"type":"string","optional":true,"field":"SQL_TEXT"}],"optional":false},"payload":{"EVENT_TIMESTAMP_UTC":1715934746826,"SESSIONID":"3738814242","USERID":"SUPERUSER","CON_NAME":"TESTDB","OS_USER":"Administrator","CLIENT_HOST_IP":"170.225.223.19","CLIENT_HOST_NAME":"sys-auto-fyre-ws51","SERVER_HOST_IP":"127.0.0.1","CLIENT_PROGRAM_NAME":"JDBC Thin Client","DBID":"2951224659","DBNAME":"TESTDB","RETURN_CODE":"1","SQL_TEXT":"INSERT INTO ACCOUNT_MASTER_SHOP_ACCOUNT_MASTER_DEPARTMENT(DEALER,ARTICLE,PRICE) VALUES('A',1,3.45)\u0000"}}', # RETURN CODE 1
    ]
    count => 1
    type => "Oua"
  }
}


filter {
  if [type] == "oua" {
      mutate {
        add_field => {"SERVER_ADDRESS" => "auto-oua-01.cxmxwdil903v.us-west-1.rds.amazonaws.com"}
        add_field => {"SERVER_PORT" => "1521"}
      }
      if "_jsonparsefailure" not in [tags] {
        oua_filter {}
    }
  }

output {
  stdout {
    codec => rubydebug
  }
}