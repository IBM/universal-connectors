# Configuring audit logs on MongoDB and forwarding to Guardium via Syslog

First, you configure the MongoDB audit logs so that they can be parsed by Guardium. Then, configure Syslog to forward the audit logs to the Guardium universal connector. This implementation supports Linux database servers.
## Before you begin:
-   Service rsyslog is installed. Preferred version: rsyslogd 8.24.0-52.el7.
-   Native audit configuration is performed by the database admin.
-   You can configure multiple collectors simultaneously using GIM \([Configuring the to handle Filebeat and Syslog on MongoDB](guc_gim_cfg.md)\). If you configure collectors manually, you need to configure them individually.
## About this task:
You can filter out any native audit events that are irrelelvant before inputting the logs to Guardium. Filter them out at the datasource server, or with a filter plugin.
## Procedure 
1.  Configure the MongoDB audit logs in the mongod.conf file.

  - Configure the AuditLog section in the mongod.conf file. 
       1. destination:syslog
       2. format:delete or comment out
       3. path:delete or comment out
        
  - Add the following field to audit the `auditAuthorizationSuccess` messages:

       
        setParameter: {auditAuthorizationSuccess: true}
       

   -  Add or uncomment the security section and edit the following parameter:
        
        authorization: enabled
        

   -  Filter: For the Guardium universal connector MongoDB filter to handle events properly, a few conditions must exist:

         1. MongoDB access control must be set. (Messages without users are removed).
         
         2. authCheck and authenticate events are not filtered out from the MongoDB audit log messages. Verify the filter section contains at least the following commands:

            
            { atype: { $in: ["authCheck", "authenticate"] } 
            }
            

            In order to narrow down the events, you can tweak the filter. For example, to audit only delete actions made in MongoDB, add the following suffix to the filter section:

            
            { atype: { $in: ["authCheck", "authenticate"] } , 
            "param.command": { $in: ["
            delete"] } }
            

            Auditing all commands can lead to excessive records. To prevent performance issues, make sure you have authCheck and authenticate log types, and additionally the commands you want to see. The filter parameters are aa allowed list. They define what you see in the logs, not what is filtered from the logs. For more information about the MongoDB filter, see [https://docs.mongodb.com/manual/tutorial/configure-audit-filters/](https://docs.mongodb.com/manual/tutorial/configure-audit-filters/).

        **Note:** The spaces in the configuration file are important, and must be located in the file as presented here.

        After configuration, the file has these lines:

        
        ...
        auditLog:
          destination: syslog
          ...
          filter:  '{ atype: { $in: ["authCheck", "authenticate"] } '
        setParameter: {auditAuthorizationSuccess: true}
        ...
        security:
          authorization: enabled
        

    **Important:** **The MongoDB needs to be restarted for the configuration changes to take effect.**

2.  The Guardium Universal Connector listens to port 5141 when using UDP, and 5000 when using TCP. Verify that the relevant port is open.

3.  Configure the Syslog data shipper to forward the audit logs into Guardium Universal Connector. In the Modules section of the Syslog configuration file rsyslog.conf \(usually located in /etc/rsyslog.conf\), enter a rule that defines the target destination for the Syslog logs. The rule looks like:

    
    :programname, isequal, "mongod" @<Universal-Connector-IP>:<port>
    

    Use @@ for logs sent by TCP, and @ for logs sent by UDP.

    **Note:** Syslog does not support load balancing. Do not define multiple hosts, since that would duplicate the events.

4.  Restart Syslog by entering the command:

    
    sudo service rsyslog restart
    


Enable the universal connector on your collector.[Enabling the Guardium universal connector on collectors](enable_guc_collectors.md)
