# GreenplumDB

## Installing Greenplumdb on RHEL

### Procedure:

#### Step 1: Configure the Systems
##### Disable or configure SELinux.
1. As the root user, check the status of SELinux:
```
$ sestatus
```
2. If SELinux is not disabled, disable it by editing the /etc/selinux/config file. as root, change the value of the SELINUX parameter in the config file as follows:
SELINUX=disabled
3. If the System Security Services Daemon (SSSD) is installed on your systems, as root, edit /etc/sssd/sssd.conf and add this parameter:
selinux_provider=none
4. Reboot the system to apply any changes that you made and verify that SELinux is disabled.
```
$ sudo reboot
```

##### Create the gpadmin account.
1. Create the gpadmin group and user.
This example creates the gpadmin group, creates the gpadmin user as a system account with a home directory and as a member of the gpadmin group, and creates a password for the user.
```
$ groupadd gpadmin
$ useradd gpadmin -r -m -g gpadmin
$ passwd gpadmin
New password: <changeme>
Retype new password: <changeme>
```

2. Grant sudo access to the gpadmin user.
3. On Red Hat or CentOS, run visudo and uncomment the %wheel group entry.
```
$ sudo -i
$ visudo

```
%wheel        ALL=(ALL)       NOPASSWD: ALL

Make sure you uncomment the line that has the NOPASSWD keyword.

4. Add the gpadmin user to the wheel group with this command.
```
$ usermod -aG wheel gpadmin
```

#### Step 2: Install the Greenplum Database
##### Installation
1. Download and copy the Greenplum Database package to the gpadmin user's home directory on the master.
```
$ wget https://github.com/greenplum-db/gpdb/releases/download/6.21.0/open-source-greenplum-db-6.21.0-rhel8-x86_64.rpm
```
2. With sudo (or as root), install the Greenplum Database package.
```
sudo yum install open-source-greenplum-db-6.21.0-rhel8-x86_64.rpm
```
3. Change the owner and group of the installed files to gpadmin.
```
$ sudo chown -R gpadmin:gpadmin /usr/local/greenplum*
$ sudo chgrp -R gpadmin /usr/local/greenplum*
```
##### Enabling Password-less SSH
1. For enabling password-less SSH, we need to copy both keys(one key is generated through the below command using a pem file, and the other key is generated by keygen(from id_rsa.pub file) in an .ssh/authorized_keys file.
```
$ ssh-keygen -y -f private_key1.pem > public_key1.pub
```
2. In RHEL, the key generated by the above command is automatically added to the authorized keys. If it is not, then manually add the key. To check whether the rsa key file is already there or not, execute the following command.
```
$ ls -al ~/.ssh/id_*.pub
```
3. If the key is not available, then we need to create new one.
```
$ ssh-keygen -t rsa -b 4096
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ec2-user/.ssh/id_rsa):
Created directory '/home/ec2-user/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
```
* Note : Do not enter any value in the prompt because this will used for password-less ssh.

4. Check whether the newly-generated key file is available or not.
```
$ cat .ssh/id_rsa.pub 
```
5. After generating the id_rsa.pub file, you need to manually copy this key into an authorized_keys file.
```
$ nano .ssh/authorized_keys
```
6. After enabling the password-less ssh, we need to verify it by running the following command.
```
$ ssh localhost
Select yes when prompted to add a hostkey(yes/no).
```
7. Execute an exkeys command. If it fails, execute the source command before it/that precedes the exkeys command.
```
$ gpssh-exkeys -h localhost
$ source /usr/local/greenplum-db-6.21.0/greenplum_path.sh
```
#### Step 3: Configuring the Greenplum Database
1. Execute the below commands  for configuration-related changes.
```
$ mkdir greenplum-db-node
$ cd greenplum-db-node
$ cp $GPHOME/docs/cli_help/gpconfigs/gpinitsystem_singlenode .
```
2. Open gpinitsystem_singlenode using nano/vi editor and update the following fields.
```
$ nano gpinitsystem_singlenode 

MACHINE_LIST_FILE=./hostlist_singlenode
declare -a DATA_DIRECTORY=(/home/<user name>/greenplum-db-node/gpdata1)
MASTER_HOSTNAME=<hostname>
MASTER_DIRECTORY=/home/<user name>/greenplum-db-node/gpmaster
```
3. Put the hostname into the hostlist_singlenode file.
```
$ nano hostlist_singlenode
```
4. Create a directory in the greenplum-db-node/ directory and execute the following commands:
```
$ mkdir gpmaster
$ mkdir gpdata1
$ gpinitsystem -c gpinitsystem_singlenode
```
#### Step 4: Setup Profile Environment for Greenplum Database 
1. Open the profile file (such as .bashrc) in a text editor.
```
$ vi ~/.bashrc
```
2. Add lines to this file to source the greenplum_path.sh file and set the MASTER_DATA_DIRECTORY environment variable.
```
$ source /usr/local/greenplum-db-6.21.0/greenplum_path.sh
$ export MASTER_DATA_DIRECTORY=/home/ec2-user/greenplum-db-node/gpmaster/gpsne-1
```
3. Save and close the file.
4. After editing the profile file, source it to make the changes active.
```
$ source ~/.bashrc
```
##### Note: 
_you must execute the above command after each server reboot event._
